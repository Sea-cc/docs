<template><div><h1 id="📖-基于-typescript-二次封装-axios" tabindex="-1"><a class="header-anchor" href="#📖-基于-typescript-二次封装-axios" aria-hidden="true">#</a> 📖 基于 typescript 二次封装 axios</h1>
<blockquote>
<p>对 axios 二次封装,更加的可配置化、扩展性更加强大灵活</p>
<p>通过 class 类实现，class 具备更强封装性(<code v-pre>封装、继承、多态</code>)，通过实例化类传入自定义的配置</p>
</blockquote>
<h3 id="创建-class" tabindex="-1"><a class="header-anchor" href="#创建-class" aria-hidden="true">#</a> 创建 class</h3>
<p>严格要求实例化时传入的配置，拥有更好的代码提示</p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">/**</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{AxiosInstance}</span><span style="color: var(--shiki-token-comment)"> axios实例类型</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{AxiosRequestConfig}</span><span style="color: var(--shiki-token-comment)"> axios配置项类型</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> */</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">type</span><span style="color: var(--shiki-color-text)"> { AxiosInstance</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> AxiosRequestConfig } </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;axios&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    axios</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosInstance</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)">) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 创建一个实例 axios.create([config])</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.axios </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.create</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 每实例化一个 axios 时，都是不同的 axios 示例，互不干扰</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    baseURL</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-string-expression)">&#39;qq.com&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    timeout:</span><span style="color: var(--shiki-token-constant)">60</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    baseURL</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-string-expression)">&#39;web.com&#39;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<h5 id="axios-create-config" tabindex="-1"><a class="header-anchor" href="#axios-create-config" aria-hidden="true">#</a> axios.create([config])</h5>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">instance</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.create</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  baseURL</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;https://some-domain.com/api/&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  timeout</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1000</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  headers</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> {</span><span style="color: var(--shiki-token-string-expression)">&#39;X-Custom-Header&#39;</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;foobar&#39;</span><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>
<p><strong>AxiosRequestConfig 的类型注解</strong></p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">D</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">&gt; {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  url</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  method</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Method</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  baseURL</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  transformRequest</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestTransformer</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestTransformer</span><span style="color: var(--shiki-color-text)">[];</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  transformResponse</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponseTransformer</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponseTransformer</span><span style="color: var(--shiki-color-text)">[];</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  headers</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestHeaders</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  params</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">paramsSerializer</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> (params</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  data</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">D</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  timeout</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  timeoutErrorMessage</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  withCredentials</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">boolean</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  adapter</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosAdapter</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  auth</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosBasicCredentials</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  responseType</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">ResponseType</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  responseEncoding</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">responseEncoding</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  xsrfCookieName</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  xsrfHeaderName</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">onUploadProgress</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> (progressEvent</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">void</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">onDownloadProgress</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> (progressEvent</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">void</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  maxContentLength</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  validateStatus</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> ((status</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">boolean</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  maxBodyLength</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  maxRedirects</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-function)">beforeRedirect</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> (options</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Record</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">&gt;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> responseDetails</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> {headers</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Record</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">&gt;}) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">void</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  socketPath</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">null</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  httpAgent</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  httpsAgent</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  proxy</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosProxyConfig</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">|</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  cancelToken</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">CancelToken</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  decompress</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">boolean</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  transitional</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">TransitionalOptions</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  signal</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AbortSignal</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  insecureHTTPParser</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">boolean</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  env</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    FormData</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-keyword)">...</span><span style="color: var(--shiki-color-text)">args</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">[]) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">object</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  };</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装-request-config-通用方法" tabindex="-1"><a class="header-anchor" href="#封装-request-config-通用方法" aria-hidden="true">#</a> 封装 request(config)通用方法</h3>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">/**</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* axios#request(config)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{*}</span><span style="color: var(--shiki-token-comment)"> config</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* </span><span style="color: var(--shiki-token-keyword)">@returns</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{*}</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">*/</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">request</span><span style="color: var(--shiki-color-text)">(config: AxiosRequestConfig) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>🏹 <strong>在 axios 中，request中的 config 参数与实例化时，<code v-pre>axios.create(config)</code>传入的参数是相同的</strong>，以下是 axios 方法具体参数</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.get</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.delete</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.head</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.options</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.post</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> data[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config]])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.put</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> data[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config]])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.patch</span><span style="color: var(--shiki-color-text)">(url[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> data[</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> config]])</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.getUri</span><span style="color: var(--shiki-color-text)">([config])</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>
<h3 id="封装-拦截器-单个实例独享" tabindex="-1"><a class="header-anchor" href="#封装-拦截器-单个实例独享" aria-hidden="true">#</a> 封装-拦截器(单个实例独享)</h3>
<p><strong>拦截器的hooks,在请求或响应被 then 或 catch 处理前拦截处理</strong></p>
<blockquote>
<p>🛹在请求中，如<code v-pre>携带token、loading动画、header配置...</code>，都是一些公有的逻辑，所以可以写到全局的拦截器里面</p>
<p>🛵注意的是，可能存在某些项目请求，需要的公有的逻辑配置方式不一样，如 A项目：<code v-pre>携带token、loading动画</code>,B项目：<code v-pre>携带token、header配置</code></p>
<p>🪂考虑到拦截方式不一样，固不能将 class 里的拦截器写si，所以，需要通过不同的 axios 实例化传入自定义的 <code v-pre>hooks(拦截器)</code>，<strong>实现单个实例独享</strong>，扩展性更强</p>
</blockquote>
<p>在上面<code v-pre>实例化 Http(Axios) 时</code>，仅仅传入 axios 约定好的 <code v-pre>config(AxiosRequestConfig)</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    baseURL</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-string-expression)">&#39;qq.com&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    timeout:</span><span style="color: var(--shiki-token-constant)">60</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过分析考虑，需要在实例化 Http 时，可以传入更多自定义的 hooks，扩展 axios。但是，<strong>在实例化时，直接传入定义好的拦截器是不可行的 <code v-pre>Why?</code></strong></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">new</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    baseURL</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;qq.com&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    timeout</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">60</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    hooks</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> {}</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)">// ERROR ❌❌⭕⭕</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">interceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> () </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {} </span><span style="color: var(--shiki-token-comment)">// ERROR ⭕⭕❌❌</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">})</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code v-pre>“hooks”不在类型“AxiosRequestConfig&lt;any&gt;”中</code>，在上面 Http class 的 constructor 构造函数中，严格约束传入的参数应为<code v-pre>AxiosRequestConfig</code>类型(TS)</p>
<p>AxiosRequestConfig 中并不存在 <code v-pre>hooks and interceptor</code>类型的属性(AxiosRequestConfig 是由 axios 提供的一个类型注解)</p>
</blockquote>
<h4 id="🚀扩展-http-自定义拦截器" tabindex="-1"><a class="header-anchor" href="#🚀扩展-http-自定义拦截器" aria-hidden="true">#</a> <strong>🚀扩展 Http 自定义拦截器</strong></h4>
<p>对 <code v-pre>AxiosRequestConfig</code> 类型注解<strong>进行继承</strong>，使得在实例化时，可以传入扩展后的类型，定义：</p>
<p>🏜️<code v-pre>IinterceptorHooks</code>接口存储自定义的拦截器函数、</p>
<p>🏙️<code v-pre>IHttpRequestConfig</code>接口继承 AxiosRequestConfig，并扩展自定义拦截器的属性，属性类型为：IinterceptorHooks</p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">🏜️</span><span style="color: var(--shiki-token-string-expression)">`IinterceptorHooks`</span><span style="color: var(--shiki-color-text)">拦截器Hook接口类型</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">type</span><span style="color: var(--shiki-color-text)"> { AxiosResponse</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> AxiosRequestConfig } </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;axios&#39;</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">/**</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * 拦截器的hooks,在请求或响应被 then 或 catch 处理前拦截</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{beforeRequestInterceptor(?)}</span><span style="color: var(--shiki-token-comment)"> 发送请求之前拦截器</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{requestErrorInterceptor(?)}</span><span style="color: var(--shiki-token-comment)"> 请求错误拦截器</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{responseSuccessInterceptor(?)}</span><span style="color: var(--shiki-token-comment)"> 响应成功拦截器</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{responseFailInterceptor(?)}</span><span style="color: var(--shiki-token-comment)"> 响应失败拦截器</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> */</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">interceptorHooks</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">beforeRequestInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">requestErrorInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (error</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">responseSuccessInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (result</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponse</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponse</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">responseFailInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (error</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">type</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IinterceptorHooks</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Partial</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">interceptorHooks</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>🌏<strong>Partial</strong>:Typescript 内置类型，<strong>将定义的类型注解全部变为可选的属性</strong></p>
<p>🪂<strong>调用说明</strong>：<code v-pre> axios.interceptors.request.use( beforeRequestInterceptor , requestErrorInterceptor );</code></p>
</blockquote>
<blockquote>
<p>请求之前拦截器中(beforeRequestInterceptor)，config 参数同样是与<code v-pre>axios.create</code>中的参数类型相同，为<code v-pre>AxiosRequestConfig</code></p>
<p>注意：并不是<code v-pre>IHttpRequestConfig</code></p>
</blockquote>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">🏙️</span><span style="color: var(--shiki-token-string-expression)">`IHttpRequestConfig`</span><span style="color: var(--shiki-color-text)"> 类构造函数 config 接口类型</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">/**</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * 实例化Http类的配置项参数,继承于AxiosRequestConfig</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{interceptors(?)}</span><span style="color: var(--shiki-token-comment)"> 拦截器Hooks</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{loading}</span><span style="color: var(--shiki-token-comment)"> 请求loading</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{...}</span><span style="color: var(--shiki-token-comment)"> 其它的配置项</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> * </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{AxiosRequestConfig}</span><span style="color: var(--shiki-token-comment)"> axios原生的配置选</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"> */</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IHttpRequestConfig</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    interceptors</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IinterceptorHooks</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🛵<strong>使用说明</strong>：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> { IHttpRequestConfig</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> IinterceptorHooks } </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;./types&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    axios</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosInstance</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    interceptors</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IinterceptorHooks</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IHttpRequestConfig</span><span style="color: var(--shiki-color-text)">) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 解构自定义的属性</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> { </span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">...</span><span style="color: var(--shiki-token-constant)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)"> } </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.axios </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.create</span><span style="color: var(--shiki-color-text)">(AxiosRequestConfig)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 存储自定义拦截Hooks or 直接 use() 使用</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.interceptors </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> interceptors</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 传入自定义请求拦截器Hooks</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">request</span><span style="color: var(--shiki-token-function)">.use</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.beforeRequestInterceptor</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.requestErrorInterceptor</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 传入自定义响应拦截器Hooks</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">response</span><span style="color: var(--shiki-token-function)">.use</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.responseSuccessInterceptor</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.responseFailInterceptor</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        )</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 扩展后的实例化...⛵</span></span>
<span class="line"><span style="color: var(--shiki-color-text)"> interceptors</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     </span><span style="color: var(--shiki-token-comment)">// ... 自定义的拦截Hooks</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     beforeRequestInterceptor</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> (config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IHttpRequestConfig</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">token</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">localStorage</span><span style="color: var(--shiki-token-function)">.getItem</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;token&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (token </span><span style="color: var(--shiki-token-keyword)">&amp;&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-color-text)">.headers) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">             </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">headers</span><span style="color: var(--shiki-color-text)">.Authorization </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> token</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)"> }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装-拦截器-所有实例共享" tabindex="-1"><a class="header-anchor" href="#封装-拦截器-所有实例共享" aria-hidden="true">#</a> 封装-拦截器(所有实例共享)</h3>
<blockquote>
<p>无论存在多少个实例的 Http，所有实例都会共享的同一套拦截器，在 class 中固定的</p>
</blockquote>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Http</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    axios</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosInstance</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">constructor</span><span style="color: var(--shiki-color-text)">(config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IHttpRequestConfig</span><span style="color: var(--shiki-color-text)">) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// ...单个实例独享拦截器处理🍳</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 所有实例共享的拦截-请求拦截器🍟</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">request</span><span style="color: var(--shiki-token-function)">.use</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (config) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 在发送请求之前做些什么</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            }</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (error) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 对请求错误做些什么</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Promise</span><span style="color: var(--shiki-token-function)">.reject</span><span style="color: var(--shiki-color-text)">(error)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 所有实例共享的拦截-响应拦截器</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">response</span><span style="color: var(--shiki-token-function)">.use</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (response) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 2xx 范围内的状态码都会触发该函数。</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 对响应数据做点什么</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> response</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            }</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (error) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 超出 2xx 范围的状态码都会触发该函数。</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 对响应错误做点什么</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Promise</span><span style="color: var(--shiki-token-function)">.reject</span><span style="color: var(--shiki-color-text)">(error)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        )</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="封装-拦截器-单个请求独享" tabindex="-1"><a class="header-anchor" href="#封装-拦截器-单个请求独享" aria-hidden="true">#</a> 封装-拦截器(单个请求独享)</h3>
<blockquote>
<p>在 axios 原生的 config(AxiosRequestConfig) 中，存在两个允许对请求or响应的数据进行转化处理：</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// `transformRequest` 允许在向服务器发送前，修改请求数据</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 它只能用于 &#39;PUT&#39;, &#39;POST&#39; 和 &#39;PATCH&#39; 这几个请求方法</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 数组中最后一个函数必须返回一个字符串， 一个Buffer实例，ArrayBuffer，FormData，或 Stream</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 你可以修改请求头。</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">transformRequest</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> [</span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (data</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> headers) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// 对发送的 data 进行任意转换处理</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> data;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}]</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">transformResponse</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> [</span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (data) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// 对接收的 data 进行任意转换处理</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> data;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}]</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>
<p>由于<code v-pre>transformRequest、transformResponse</code>为 Axios 原生的API，所以尽量不去改变原有的 config API</p>
<blockquote>
<p>🍟在需要不修改原生 Axios config 情况下，<strong>扩展单个请求独享的拦截器</strong>时</p>
<p>🍳class 封装的方法：<code v-pre>request(config: AxiosRequestConfig){}</code>参数中<strong>不能再使用原生<code v-pre>AxiosRequestConfig</code>作为参数的注解</strong></p>
<p>🫕前面提到过，request 中的 config 参数与实例化时传入的参数是相同的，所以<strong>在这里同样可以使用<code v-pre>IHttpRequestConfig</code>，作为 request 的参数注解</strong></p>
</blockquote>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">/**</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* axios#request(config)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* </span><span style="color: var(--shiki-token-keyword)">@param</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{*}</span><span style="color: var(--shiki-token-comment)"> config</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* </span><span style="color: var(--shiki-token-keyword)">@returns</span><span style="color: var(--shiki-token-comment)"> </span><span style="color: var(--shiki-token-function)">{*}</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">*/</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">request</span><span style="color: var(--shiki-color-text)">(config: AxiosRequestConfig) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">	</span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// ...改为 AxiosRequestConfig -&gt; IHttpRequestConfig</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">request</span><span style="color: var(--shiki-color-text)">(config: IHttpRequestConfig) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-comment)">// ... 在执行请求之前，执行单个请求独享的拦截器(?)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">(config)</span><span style="color: var(--shiki-token-function)">.then</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    	</span><span style="color: var(--shiki-token-comment)">// ... </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    )</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>具体代码实现：</strong></p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// Http 封装的request🫕</span></span>
<span class="line"><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">request</span><span style="color: var(--shiki-color-text)">(config: IHttpRequestConfig) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     </span><span style="color: var(--shiki-token-comment)">// 存在单个方法独享自定义拦截器Hooks(请求之前)🍀</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.beforeRequestInterceptor) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-comment)">// 立即执行beforeRequestInterceptor方法，传入config处理返回新的处理后的config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         config </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.beforeRequestInterceptor</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-color-text)">.axios</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-function)">.then</span><span style="color: var(--shiki-color-text)">((result) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-comment)">// 存在单个方法独享自定义拦截器Hooks(响应成功)🍃</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.responseSuccessInterceptor) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">             </span><span style="color: var(--shiki-token-comment)">// 立即执行beforeRequestInterceptor方法，传入config处理返回新的处理后的config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">             result </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.responseSuccessInterceptor</span><span style="color: var(--shiki-color-text)">(result)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> result</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     })</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-function)">.catch</span><span style="color: var(--shiki-color-text)">((error) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-comment)">// 存在单个方法独享自定义拦截器Hooks(响应失败)🌄</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> (</span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-color-text)">?.responseFailInterceptor) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">             </span><span style="color: var(--shiki-token-comment)">// 立即执行beforeRequestInterceptor方法，传入config处理返回新的处理后的config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">             error </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.responseFailInterceptor</span><span style="color: var(--shiki-color-text)">(error)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">         </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> error</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">     })</span></span>
<span class="line"><span style="color: var(--shiki-color-text)"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 执行 request 方法，传入拦截器处理🌏，如：</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    url</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;/api/addUser&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    methed</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;POST&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    interceptors</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">beforeRequestInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)">(config) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">// ...处理config数据</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        }</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// ...请求错误处理不拦截</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-function)">responseSuccessInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)">(result) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> result</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">})</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>注意：当存在单个方法独享自定义请求拦截器时，应当在发送请求之前<strong>立即执行 beforeRequestInterceptor 方法</strong>，而不是通过传入到 use() 回调，执行请求拦截方法处理完之后返回一个经过处理的 config，在传入到请求方法中，发送请求</p>
<p>其它的单个方法独享自定义响应拦截器一样</p>
</blockquote>
<h3 id="装修-http-class" tabindex="-1"><a class="header-anchor" href="#装修-http-class" aria-hidden="true">#</a> 装修 Http class</h3>
<h4 id="返回经过" tabindex="-1"><a class="header-anchor" href="#返回经过" aria-hidden="true">#</a> 返回经过</h4>
<blockquote>
<p>在响应数据时候(响应拦截器)，<strong>Axios 为数据在外层包装了一层对象，后台返回的数据就存在于 result 的 data 中</strong>，所以需要对数据再一步的处理，扒开最外层的皮</p>
<p><strong>注意：Axios 在外层包装的对象数据，其实在某些情况下是需要 result 中的一些属性数据的，并不仅仅需要 data，比如返回格式为文件数据中，需要 headers 中的一些数据对文件进行处理，命名等...</strong></p>
<p>这里的扒皮处理，逻辑应当属于所有实例共享的一个拦截器，<strong>具体工具需要进行处理</strong></p>
</blockquote>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// 所有实例共享的拦截-响应拦截器</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">this</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">response</span><span style="color: var(--shiki-token-function)">.use</span><span style="color: var(--shiki-color-text)">(</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (response) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 返回为文件流时,直接返回(文件需要单独处理)🪂</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> ([</span><span style="color: var(--shiki-token-string-expression)">&#39;blob&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;arraybuffer&#39;</span><span style="color: var(--shiki-color-text)">]</span><span style="color: var(--shiki-token-function)">.includes</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">response</span><span style="color: var(--shiki-color-text)">.</span><span style="color: var(--shiki-token-constant)">request</span><span style="color: var(--shiki-color-text)">.responseType)) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">// if (response.headers[&#39;content-disposition&#39;]) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//     let fileName = response.headers[&#39;content-disposition&#39;].split(&#39;filename=&#39;)[1]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//     fileName = decodeURI(fileName)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//     return {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//         data: response.data,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//         fileName</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">//     }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-comment)">// }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> response</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 根据业务码 or 状态码...进行判断</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 扒皮🛵</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">response</span><span style="color: var(--shiki-color-text)">.data</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)"> (error) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 超出 2xx 范围的状态码都会触发该函数。</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-comment)">// 对响应错误做点什么</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        </span><span style="color: var(--shiki-token-keyword)">return</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">Promise</span><span style="color: var(--shiki-token-function)">.reject</span><span style="color: var(--shiki-color-text)">(error)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="request-返回数据结构-dto" tabindex="-1"><a class="header-anchor" href="#request-返回数据结构-dto" aria-hidden="true">#</a> request 返回数据结构(DTO)</h4>
<p>定义返回数据类型注解</p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// 最终数据类型注解</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IDateType</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    [key</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">]</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// axios 返回的数据类型注解，IDateType === T</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IDTO</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">&gt; {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    code</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    data</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">T</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    message</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    state</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">number</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    [prop</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">string</span><span style="color: var(--shiki-color-text)">]</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 请求方法，传入注解</span></span>
<span class="line"><span style="color: var(--shiki-token-constant)">axios</span><span style="color: var(--shiki-token-function)">.request</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">IDTO</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">IDateType</span><span style="color: var(--shiki-color-text)">&gt;&gt;({</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    url</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;/api/addUser&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    methed</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;POST&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">})</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于在所有实例共享的响应拦截器中，修改了返回的数据结构<code v-pre>return response.data</code>,<strong>到达方法响应拦截器中的数据类型已经不再是<code v-pre>AxiosResponse</code>，导致在响应成功的拦截器中类型错误无法赋值，以及.then返回的类型不正确无法返回,正确应该为<code v-pre>DTO</code>类型</strong>，解决方案：</p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// 修改 AxiosRequestConfig 类型注解，默认类型为原来的 AxiosResponse，传递到响应成功的拦截中进行泛型注解，用于在方法中重新修改返回的数据类型</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 最终的泛型类型注解到达 responseSuccessInterceptor 中</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">interceptorHooks</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)">&gt; {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">beforeRequestInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (config</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">requestErrorInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (error</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">responseSuccessInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (result</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">T</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">responseFailInterceptor</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> (error</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">any</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">type</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IinterceptorHooks</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponse</span><span style="color: var(--shiki-color-text)">&gt; </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">Partial</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">interceptorHooks</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)">&gt;&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">export</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">interface</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IHttpRequestConfig</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosResponse</span><span style="color: var(--shiki-color-text)">&gt; </span><span style="color: var(--shiki-token-keyword)">extends</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">AxiosRequestConfig</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    interceptors</span><span style="color: var(--shiki-token-keyword)">?:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">IinterceptorHooks</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)">&gt;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 修改 Http class request方法，通过 泛型 T 接受方法传达过来的 DTO 类型注解，传递到 IHttpRequestConfig 中修改 responseSuccessInterceptor 的参数类型注解以及返回值注解，在单个方法独享自定义拦截器中就可以接受参数，并且返回正确的 DTO 类型数据</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// 由于在下面的 this.axios.request() 方法中，返回的数据已经被上一个拦截器扒皮修改了，返回的 result 类型注解中存在类型不正确情况(正确返回应返回response.data的类型注解)，实际返回为 AxiosResponse&lt;any,any&gt;类型注解，导致数据返回到最外层方法时编辑器报错(最外层接受 DTO 类型)，所以需要手动修改this.axios.request() 方法中返回的类型注解 this.axios.request&lt;any, T&gt;()</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">request</span><span style="color: var(--shiki-color-text)">&lt;</span><span style="color: var(--shiki-token-function)">T</span><span style="color: var(--shiki-color-text)">&gt;(config: IHttpRequestConfig</span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-token-constant)">T</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)">): </span><span style="color: var(--shiki-token-constant)">Promise</span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-token-constant)">T</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> {  </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">        return this.axios</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            .request&lt;any</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> T&gt;(config)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            .then((result) =&gt; {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-comment)">// 存在单个方法独享自定义拦截器Hooks(响应成功)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                </span><span style="color: var(--shiki-token-function)">if</span><span style="color: var(--shiki-color-text)"> (config.interceptors?.responseSuccessInterceptor) {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                    </span><span style="color: var(--shiki-token-comment)">// 立即执行beforeRequestInterceptor方法，传入config处理返回新的处理后的config</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                    result </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">config</span><span style="color: var(--shiki-token-function)">.</span><span style="color: var(--shiki-token-constant)">interceptors</span><span style="color: var(--shiki-token-function)">.responseSuccessInterceptor</span><span style="color: var(--shiki-color-text)">(result)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                }</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                return result</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            })</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            </span><span style="color: var(--shiki-token-function)">.catch</span><span style="color: var(--shiki-color-text)">((error) </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">              </span><span style="color: var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">            })</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拦截器执行顺序" tabindex="-1"><a class="header-anchor" href="#拦截器执行顺序" aria-hidden="true">#</a> 拦截器执行顺序</h3>
<blockquote>
<p>由于在 constructor(构造函数) <strong>代码顺序：单个实例独享拦截器  -&gt;  所有实例共享拦截器  -&gt;...</strong></p>
<p>🌄<strong>单个实例独享拦截器位于所有实例共享拦截器之前</strong>，执行顺序为：</p>
<p><strong><code v-pre>所有实例共享请求拦截器  -&gt;  单个实例独享请求拦截器  -&gt;  单个实例独享响应拦截器  -&gt;  所有实例共享响应拦截器</code></strong></p>
<p>反之，则：</p>
<p>🌅<strong>所有实例共享拦截器位于之前单个实例独享拦截器</strong>，执行顺序为：</p>
<p><strong><code v-pre>单个实例独享请求拦截器  -&gt;  所有实例共享请求拦截器  -&gt;  所有实例共享响应拦截器  -&gt;  单个实例独享响应拦截器</code></strong></p>
<p>🌏<strong>单个方法独享拦截器(单个实例独享拦截器位于所有实例共享拦截器之前)</strong>，执行顺序为：</p>
<p><strong><code v-pre>单个方法请求拦截器  -&gt;  实例共享请求拦截器  -&gt;  单个独享请求拦截器  -&gt;  单个独享响应拦截器  -&gt;  实例共享响应拦截器  -&gt;  单个方法响应拦截器</code></strong></p>
<p>请求拦截：constructor<strong>先执行的代码</strong>(use())，拦截器里面的回调hook<strong>后被执行</strong>，反之，<strong>先被执行</strong></p>
<p>响应拦截：constructor<strong>先执行的代码</strong>(use())，拦截器里面的回调hook<strong>先被执行</strong>，反之，<strong>后被执行</strong></p>
<p>需要修改执行顺序可调整代码的执行顺序</p>
</blockquote>
<h3 id="操作场景控制" tabindex="-1"><a class="header-anchor" href="#操作场景控制" aria-hidden="true">#</a> 操作场景控制</h3>
<blockquote>
<p>由于存在三种拦截器，存在一些复杂的操作场景时，比如，通过给所有实例或者单独实例提前添加了操作<code v-pre>loading、错误捕获...</code>，但是现在需要在某个请求方法中不进行此操作时，如何解决？</p>
<p><strong>解决方案：通过继续扩展特定的 IHttpRequestConfig 类型属性，因为<code v-pre>单个方法请求拦截器是最先执行</code>的，IHttpRequestConfig 配置项，在<code v-pre>所有的拦截器中是共享的</code>，层级传递的，<code v-pre>在拦截器中判断特定的属性值</code>关闭不需要的操作</strong></p>
</blockquote>
</div></template>
