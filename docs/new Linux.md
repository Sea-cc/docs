# Linux

æŸ¥çœ‹ç½‘å¡é…ç½® `ip addr`

![image-20220917124443279](/img/image-20220917124443279.png)

ä¸Šå›¾çœ‹åˆ°è™šæ‹Ÿæœºçš„ç½‘å¡æ˜¯æœ‰ï¼Œä½†æ˜¯æ²¡æœ‰ **ip åœ°å€**ï¼Œæ¥ä¸‹æ¥è¿›è¡Œç½‘å¡é…ç½® IP åœ°å€ç­‰...

### åŠ¨æ€çš„ç½‘ç»œé…ç½®

**åœ¨ Linux ä¸­ï¼Œä¸€åˆ‡é…ç½®é€šè¿‡æ–‡ä»¶å»ä¿®æ”¹**

`vi /etc/sysconfig/network-scripts/`ã€**åŒå‡»ä¸¤ä¸‹ tab é”®å³å¯æŸ¥çœ‹å½“å‰è·¯å¾„ç›®å½•ä¸‹çš„è¯¦æƒ…æ–‡ä»¶ ğŸ”¥**ã€‘

![image-20220917125346919](/img/image-20220917125346919.png)

è™šæ‹Ÿæœºç½‘ç»œé…ç½®æ–‡ä»¶ `vi /etc/sysconfig/network-scripts/ifcfg-ens33`

![image-20220917125649572](/img/image-20220917125649572.png)

ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶**é‡å¯ç½‘ç»œæœåŠ¡** `systemctl restart network`

> å‡ºç°é‡å¯ç½‘ç»œæœåŠ¡å¤±è´¥ï¼ŒæŸ¥çœ‹ vm çš„ç½‘ç»œé€‚é…å™¨é…ç½®æ˜¯å¦æ­£ç¡®

> æ³¨æ„ï¼šå½“å‰çš„ç½‘ç»œé…ç½®ä¸ºåŠ¨æ€è‡ªåŠ¨ dhcp é…ç½®(è‡ªåŠ¨åˆ†é…)

---

ç½‘ç»œæœåŠ¡æ­£å¸¸å¯åŠ¨åï¼Œä½¿ç”¨ **Xshell** è¿æ¥è™šæ‹Ÿæœº(Xshell ç›¸æ¯” Linux è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·æ›´å¥½ç”¨ï¼Œå¯ä»¥å¤åˆ¶ç²˜è´´)

**1ã€æŸ¥çœ‹è™šæ‹Ÿæœº ip åœ°å€**

è¾“å…¥ `ip addr`ï¼ŒæŸ¥çœ‹è™šæ‹Ÿæœºçš„ç½‘å¡é…ç½®ï¼Œmeï¼š192.168.254.128

å°è¯•æœ¬åœ°ç”µè„‘ ping 192.168.254.128

**2ã€ä½¿ç”¨ Xshell è¿æ¥ Linux è™šæ‹Ÿæœº**

<img src="/img/image-20220917132853438.png" alt="image-20220917132853438" style="zoom:50%;" /><img src="/img/image-20220917133003040.png" alt="image-20220917133003040" style="zoom: 65%;" />

### é…ç½®é™æ€çš„ç½‘ç»œé…ç½®

> åœ¨ä¸Šé¢åŠ¨æ€çš„ç½‘ç»œé…ç½®æ—¶ï¼Œä½¿ç”¨ DHCP è‡ªåŠ¨åˆ†é… IPï¼Œåœ¨ç”µè„‘é‡å¯å IP å¯èƒ½è¢«æ”¹å˜ï¼Œè¿™æ—¶æ¯”å¦‚ Xshell åˆè¦é‡æ–°æŸ¥çœ‹ è™šæ‹Ÿæœºçš„ IP é‡æ–°è¿æ¥

é…ç½®é™æ€çš„ç½‘ç»œé…ç½®ï¼š

**1ã€ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶** `vi /etc/sysconfig/network-scripts/ifcfg-ens33`

æ³¨æ„ï¼šåŒºåˆ†å¤§å°å†™ï¼Œ`=`å·¦è¾¹ä»¥ä¸ºå¤§å†™å­—æ¯

```shell
ä¿®æ”¹åˆ†é…ç±»å‹
BOOTPROTO=dhcp æ”¹ä¸º static é™æ€
BOOTPROTO=static

åœ¨é…ç½®æ–‡ä»¶ä¸‹æ–°å¢
IPADDR=192.168.31.88 é™æ€çš„ IP åœ°å€
NETMASK=255.255.255.0 å­ç½‘æ©ç 
GATEWAY=192.168.31.1 ç½‘å…³ï¼Œç½‘å…³ä¾æ® Vmware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„é…ç½®ğŸ”¥ï¼Œå¹¶ä¸æ˜¯ cmd ä¸‹çš„ä¿¡æ¯
DNS1=8.8.8.8 DNS æœåŠ¡å™¨(å¯ä»¥é…ç½®æ›´å¤šçš„NDS,ç»Ÿä¸€ä»¥1ã€2ã€3ç»“å°¾)
```

![image-20220917134509957](/img/image-20220917134509957.png)

![image-20220917134542296](/img/image-20220917134542296.png)

**2ã€ä¿å­˜é…ç½®æ–‡ä»¶ esc :wqï¼Œcqi**

**3ã€é‡å¯ç½‘ç»œæœåŠ¡ `systemctl restart network`**

é‡å¯ä¹‹åè™šæ‹Ÿæœº IP å·²ç»å˜äº†ï¼ŒXshell å¤„äºåœé¡¿çŠ¶æ€ï¼Œéœ€è¦é‡æ–°è¿æ¥

![image-20220917134759862](/img/image-20220917134759862.png)

> æ³¨æ„ï¼šåœ¨å­¦ä¹ é˜¶æ®µå¯ä»¥éšæ„ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶ ipã€‚ä½†æ˜¯åœ¨ç”Ÿäº§é˜¶æ®µï¼Œå¯èƒ½ä¼šé€ æˆç½‘ç»œ ip å†²çªç½‘ç»œè”ç½‘çŠ¶æ€

### æ’æŸ¥è™šæ‹Ÿæœºä¸èƒ½ä¸Šç½‘

> ä¿®æ”¹é™æ€çš„ ip åå¯¼è‡´ç½‘ç»œè”ç½‘

**1ã€åœ¨æœ¬åœ° cmd ping è™šæ‹Ÿæœº DNS æœåŠ¡**

`ping 8.8.8.8`

æ­£å¸¸æƒ…å†µä¸‹æ˜¯èƒ½ ping è™šæ‹Ÿæœºçš„ DNS æœåŠ¡çš„

**2ã€åœ¨è™šæ‹Ÿæœº ping DNS æœåŠ¡**

`ping 8.8.8.8`

**3ã€æŸ¥çœ‹ç½‘ç»œé…ç½®æ–‡ä»¶**

`vi /etc/sysconfig/network-scripts/ifcfg-ens33`

```shell
IPADDR=192.168.31.88
NETMASK=255.255.255.0
GATEWAY=192.168.31.1  ç½‘å…³ä¾æ® Vmware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„é…ç½®
DNS1=8.8.8.8
```

**4ã€æ‰“å¼€ Vmware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„é…ç½®ï¼ŒæŸ¥çœ‹ç½‘å…³**

æ›´æ”¹è®¾ç½® - é€‰æ‹© NAT æ¨¡å¼ç±»å‹ - NAT è®¾ç½®

![image-20220917140835380](/img/image-20220917140835380.png)

> å‘ç°æ˜¯ç½‘å…³é…ç½®é”™è¯¯

**5ã€é‡æ–°ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶ or ä¿®æ”¹ NAT è®¾ç½®é…ç½®**

```shell
IPADDR=192.168.254.88
NETMASK=255.255.255.0
GATEWAY=192.168.254.2  ç½‘å…³ä¾æ® Vmware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„é…ç½®
DNS1=8.8.8.8
```

**6ã€é‡å¯ç½‘ç»œæœåŠ¡** `systemctl restart network`

7ã€æµ‹è¯•è¿æ¥ç½‘ç»œæ˜¯å¦æˆåŠŸ `ping qq.com`

> å¦å¤–ï¼Œå¯ä»¥åœ¨æœ¬åœ°ç½‘ç»œé…ç½®ä¸­æŸ¥çœ‹ï¼Œç”µè„‘ç»™ Vmware åˆ†é…çš„ç½‘ç»œç½‘å…³ä¿¡æ¯
>
> æ§åˆ¶é¢æ¿ - ç½‘ç»œ - Vmware8 - è¯¦ç»†ä¿¡æ¯ - IPv4 WINS æœåŠ¡å™¨

![image-20220917141636140](/img/image-20220917141636140.png)

## Nginx

Nginx å¼€æºç‰ˆ http://nginx.org/ å®‰è£…

åœ¨å®‰è£…ä¹‹å‰å…ˆè¿›è¡Œè™šæ‹Ÿæœºçš„`å¤‡ä»½`

**1ã€æ‰“å¼€ Xshell çš„æ–‡ä»¶ä¼ è¾“å·¥å…· Xftpï¼Œå¯¹ Nginx å®‰è£…åŒ…è¿›è¡Œä¼ è¾“åˆ° è™šæ‹Ÿæœºä¸Š**

![image-20220917143234589](/img/image-20220917143234589.png)

**2ã€è§£å‹ç¼©**

å‹ç¼©åŒ…ä¸º tar ï¼Œä½¿ç”¨ tar è§£å‹ `tar zxvf nginx-1.22.0.tar.gz`

**3ã€ä½¿ç”¨ nginx æä¾›çš„è„šæœ¬ configure è¿›è¡Œå®‰è£…**

è¿›å…¥ nginx è§£å‹ç›®å½•ä¸‹

![image-20220917143529771](/img/image-20220917143529771.png)

åœ¨å®‰è£…å‰éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–ï¼Œå¦‚ GCCï¼Œæ‰§è¡Œ `./configure` æŸ¥çœ‹çœ‹å®‰è£…éœ€è¦çš„ä¾èµ–

`./configure: error: C compiler cc is not found`

![image-20220917143748121](/img/image-20220917143748121.png)

å®‰è£…ä¾èµ– gcc `yum install -y gcc`

-yï¼šå¤„ç†æç¤ºæ˜¯å¦è¯­å¥ï¼Œyes

**4ã€å®‰è£… Nginx**

**`./configure --prefix=/usr/local/nginx`**

> --prefix= ğŸƒ
>
> è¡¨ç¤ºå®‰è£…æ–‡ä»¶åœ¨å“ªä¸ªç›®å½•ä¸‹

å‘ç”Ÿé”™è¯¯

```
./configure: error: the HTTP rewrite module requires the PCRE library.
You can either disable the module by using --without-http_rewrite_module
option, or install the PCRE library into the system, or build the PCRE library
statically from the source with nginx by using --with-pcre=<path> option.
```

ç¼ºå°‘ **PCRE** åº“ï¼Œç»§ç»­å®‰è£…ä¾èµ–

`yum install -y pcre pcre-devel`

> -devel
>
> è¡¨ç¤ºå¼€å‘ä¾èµ–

å‘ç”Ÿé”™è¯¯

```
./configure: error: the HTTP gzip module requires the zlib library.
You can either disable the module by using --without-http_gzip_module
option, or install the zlib library into the system, or build the zlib library
statically from the source with nginx by using --with-zlib=<path> option.
```

ç¼ºå°‘ **zlib** åº“ï¼Œç»§ç»­å®‰è£…ä¾èµ–

`yum install -y zlib zlib-devel`

**5ã€ç»§ç»­å®‰è£…ï¼ŒæˆåŠŸï¼ï¼**ï¼

æ¥ä¸‹æ¥æ‰§è¡Œ

`make`

`make install`

### å¯åŠ¨ Nginx

è¿›å…¥ Nginx å®‰è£…ç›®å½• `cd /usr/local/nginx/`

```js
[root@localhost nginx-1.22.0]# cd /usr/local/nginx/
[root@localhost nginx]# ls
conf  html  logs  sbin
```

#### å¯åŠ¨æœåŠ¡

> åœ¨æ²¡æœ‰å¯åŠ¨è„šæœ¬ä¹‹å‰ï¼Œåªèƒ½æ‰‹åŠ¨å¯åŠ¨ NginxğŸ—ï¸
>
> cd /sbin
>
> æ‰§è¡Œ ./nginx

#### éªŒè¯å¯åŠ¨

åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è®¿é—®è™šæ‹Ÿæœº ip `ip addr`

> **æ³¨æ„ï¼šåœ¨è®¿é—®æœåŠ¡ä¹‹å‰ ğŸ’¡**
>
> **å…³é—­é˜²ç«å¢™**
>
> `systemctl stop firewalld.service`
>
> **ç¦æ­¢é˜²ç«å¢™å¼€æœºå¯åŠ¨**
>
> `systemctl disable firewalld.service`
>
> **æ”¾è¡Œç«¯å£**
>
> `firewall-cmd --zone=public --add-port=80/tcp --permanent`
>
> **é‡å¯é˜²ç«å¢™**
>
> `firewall-cmd --reload`

è®¿é—® **http://192.168.254.88/**

```
Welcome to nginx!
If you see this page, the nginx web server is successfully installed and working. Further configuration is required.

For online documentation and support please refer to nginx.org.
Commercial support is available at nginx.com.

Thank you for using nginx.Welcome to nginx!
```

#### å¯åŠ¨å‘½ä»¤

```
./nginx å¯åŠ¨ï¼Œæ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶å¯åŠ¨ï¼ŒåŒæ—¶å¯åŠ¨ã€ä¸»çº¿ç¨‹ - å­çº¿ç¨‹...ã€‘
./nginx -s stop å¿«é€Ÿåœæ­¢
./nginx -s quit ä¼˜é›…å…³é—­ï¼Œåœ¨é€€å‡ºå‰å®Œæˆå·²ç»æ¥å—çš„è¿æ¥è¯·æ±‚
./nginx -s reload é‡æ–°åŠ è½½é…ç½®ï¼Œåœ¨æ›´æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œè®©æœåŠ¡ç«‹å³ç”Ÿæ•ˆè€Œä¸ç”¨é‡å¯æ•´ä¸ªnginxæœåŠ¡
```

> ./nginx -s reload ğŸ’¡
>
> åœ¨é‡å¯å‰æš‚ç•™å·²ç»æ¥å—è¯·æ±‚çš„çº¿ç¨‹ï¼Œå…¶å®ƒçš„çº¿ç¨‹è¢«å¹²æ‰ï¼Œç­‰é‡å¯å®Œæˆåå¹²æ‰æš‚ç•™çš„çº¿ç¨‹ï¼Œä½¿ç”¨æ–°çš„çº¿ç¨‹å»å¤„ç†è¯·æ±‚

#### è®¾ç½®ç¯å¢ƒå˜é‡å¯åŠ¨

**1ã€æ‰“å¼€ç¯å¢ƒå˜é‡æ‰€åœ¨çš„æ–‡ä»¶ï¼š**

```
vim /etc/profile
```

**2ã€åœ¨ profile æ–‡ä»¶æœ«å°¾ï¼ŒåŠ ä¸Šä¸€è¡Œ**

æŒ‡å‘ä½ çš„ nginx çš„å®‰è£…ä½ç½®çš„ sbin ç›®å½•

```
PATH=$PATH:/usr/local/nginx/sbin
```

**3ã€é‡æ–°åŠ è½½ç¯å¢ƒï¼Œè§£å†³**

```
source /etc/profile
```

#### ä½¿ç”¨è„šæœ¬å¯åŠ¨ Nginx

ä½¿ç”¨è„šæœ¬å®‰è£…æˆç³»ç»ŸæœåŠ¡å¯åŠ¨ï¼Œåœ¨`/usr/lib/systemd/system`ä¸‹åˆ›å»ºæœåŠ¡è„šæœ¬

`vi /usr/lib/systemd/system/nginx.service`

```
æ³¨æ„å®‰è£…çš„æ–‡ä»¶è·¯å¾„
[Unit]
Description=nginx - web server
After=network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid
ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s stop
ExecQuit=/usr/local/nginx/sbin/nginx -s quit
PrivateTmp=true
[Install]
WantedBy=multi-user.target
```

> è§£å†³ Xshell ç²˜è´´æ•°æ®ä¸¢å¤± ğŸ’¡
>
> **vi è¿›å…¥æ–‡ä»¶ - æŒ‰ä¸‹ a é”® è¿›å…¥ insert çŠ¶æ€ç²˜è´´**

> **æ–°å¢æœåŠ¡è„šæœ¬åéœ€è¦é‡æ–°åŠ è½½ç³»ç»ŸæœåŠ¡**
>
> `systemctl daemon-reload`

> **æŸ¥çœ‹æœåŠ¡å¯åŠ¨çŠ¶æ€ç«¯å£å·ä¿¡æ¯...**ğŸƒ
>
> `ps -ef | grep nginx`

ä½¿ç”¨æœåŠ¡è„šæœ¬å¯åŠ¨ Nginx

**`systemctl start nginx.service`**

#### å¼€æœºå¯åŠ¨

**`systemctl enable nginx.service`**

> é‡å¯è¿™ä¸ª Linux è™šæ‹ŸæœºæœåŠ¡å‘½ä»¤ ğŸƒ
>
> **`reboot`**

### Nginx ç›®å½•ç»“æ„ä¸åŸºæœ¬è¿è¡ŒåŸç†

ä½¿ç”¨ Xftp æŸ¥çœ‹ Nginx æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œåœ¨`/usr/local/nginx`ç›®å½•ä¸‹(NGINX å‡ ä¹ä¸€åˆ‡å¯ä»¥é…ç½®)

#### æ ¹ç›®å½•

> ![image-20220917153454548](/img/image-20220917153454548.png)

> **æ³¨æ„ ğŸ’¡**
>
> ğŸŸ ä»¥`_temp`ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œæ˜¯ nginx è¿è¡Œåæ‰äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¸´æ—¶ç›®å½•
>
> ğŸ• `conf` nginx æ‰€æœ‰é…ç½®æ–‡ä»¶çš„ç›®å½•(config)
>
> ğŸ¥¯ `html` nginx é»˜è®¤ç«™ç‚¹ç›®å½•
>
> ğŸ§€ `log` nginx æ—¥å¿—ç›®å½•
>
> ğŸ¤ `sbin` nginx å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•(ä¸»ç¨‹åº)

nginx é…ç½®æ–‡ä»¶ä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š

```nginx
main{ #ï¼ˆå…¨å±€è®¾ç½®ï¼‰
    http{ #æœåŠ¡å™¨é…ç½®
        upstream{} #ï¼ˆè´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®ï¼‰
        server{ #ï¼ˆä¸»æœºè®¾ç½®ï¼šä¸»è¦ç”¨äºæŒ‡å®šä¸»æœºå’Œç«¯å£ï¼‰
            location{} #ï¼ˆURLåŒ¹é…çš„è®¾ç½®ï¼‰
        }
    }
}
```

#### conf

> ä¸»é…ç½®æ–‡ä»¶ `nginx.conf`
>
> ![image-20220917154613175](/img/image-20220917154613175.png)

> `nginx.conf`
>
> nginx.conf ä¼šå¼•ç”¨ conf ç›®å½•ä¸‹å…¶å®ƒçš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼ŒåæœŸæ–‡ä»¶é…ç½®è¾ƒå¤šä¹Ÿå¯ä»¥å°†é…ç½®æ–‡ä»¶åˆ†å¼€ç®¡ç† ğŸ™†â€

#### html

> nginx é»˜è®¤ç«™ç‚¹ç›®å½•(é»˜è®¤åªèƒ½å­˜æ”¾**ä¸€ä¸ªç«™ç‚¹**)
>
> ğŸ›¹ `50x.html` é”™è¯¯é¡µé¢ä¼˜é›…æ›¿ä»£æ˜¾ç¤ºæ–‡ä»¶ï¼Œä¾‹å¦‚å‡ºç° 502 é”™è¯¯æ—¶ä¼šè°ƒç”¨æ­¤é¡µé¢
>
> ğŸ›´ `index.html` é»˜è®¤çš„é¦–é¡µæ–‡ä»¶
>
> ğŸï¸ æ–‡ä»¶ä»¥ `.htm` åç¼€ä½œç”¨ä¸ºå…¼å®¹æ—§ç‰ˆæœ¬

#### log

> nginx æ—¥å¿—ç›®å½•
>
> ğŸ¨ `access.log` è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•ç”¨æˆ·è®¿é—®çš„ä¿¡æ¯(**æ­¤æ–‡ä»¶å¯èƒ½æ¯”è¾ƒå¤§ï¼Œå¯ä»¥é™åˆ¶å¤§å°ï¼Œå æ»¡ç£ç›˜å®¹é‡å¯èƒ½é€ æˆè«åå…¶å¦™çš„é—®é¢˜**)
>
> ğŸ§µ `error.log` é”™è¯¯æ—¥å¿—æ–‡ä»¶
>
> ğŸ§¶ `nginx.pid` pid æ–‡ä»¶ï¼Œnginx è¿›ç¨‹å¯åŠ¨åï¼Œä¼šæŠŠæ‰€æœ‰è¿›ç¨‹çš„ ID å·å†™åˆ°æ­¤æ–‡ä»¶(å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å·å¹²æ‰è¿›ç¨‹)

#### Nginx è¿è¡ŒåŸç†

> ![](/img/nginxè¿è¡ŒåŸç†.png)

> **Nginx åˆ†ä¸ºä¸¤ç§è¿›ç¨‹ Masterã€Worker**ï¼Œé€šè¿‡ ps è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤å¯ä»¥çœ‹åˆ°è¯¦æƒ…(ç”±å¤šä¸ªè¿›ç¨‹å®Œæˆç”¨æˆ·çš„è¯·æ±‚)
>
> Masterï¼šä¸»è¿›ç¨‹ä¸å¤„ç†è¯·æ±‚ä¸šåŠ¡ï¼Œè´Ÿè´£åè°ƒå­è¿›ç¨‹ï¼Œæ ¡éªŒé…ç½®æ–‡ä»¶
>
> Workerï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œè¯»å–æ–‡ä»¶å“åº”è¯·æ±‚ï¼Œå°†æ”¶åˆ°çš„è¯·æ±‚è½¬å‘çš„åˆ°åç«¯æœåŠ¡ç«¯ï¼Œworker è¿›ç¨‹çš„ä¸ªæ•°**å¯ä»¥åœ¨ nginx.conf æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®**
>
> ä¸»è¿›ç¨‹ä¸å­è¿›ç¨‹(ä¸šåŠ¡è¿›ç¨‹)å…¨éƒ¨å¯åŠ¨å®Œæˆåï¼Œæ¥ä¸‹æ¥ç­‰å¾…ç”¨æˆ·è¯·æ±‚ï¼Œç”¨æˆ·è¯·æ±‚è¿›æ¥ï¼Œç”±å­è¿›ç¨‹(Worker)å“åº”å¹¶è§£æè¿”å›
>
> å½“ç”¨æˆ·è¯·æ±‚è¿›æ¥ï¼Œå­è¿›ç¨‹ä¼šè§£æç”¨æˆ·è¯·æ±‚ï¼Œç„¶åè¯»å–`/conf/nginx.conf`é…ç½®ï¼Œè¯»å–ç”¨æˆ·è®¿é—®çš„èµ„æºåœ°å€ï¼Œè§£æè¯»å–æ–‡ä»¶å“åº”å›ç»™ç”¨æˆ·

#### Nginx é…ç½®ä¸åº”ç”¨åœºæ™¯

### æœ€å°é…ç½®

######

> ğŸ® **worker_processes**
>
> `worker_processes 1;` é»˜è®¤ä¸º 1ï¼Œè¡¨ç¤ºå¼€å¯ä¸€ä¸ªä¸šåŠ¡è¿›ç¨‹ (Worker)
>
> `/proc/cpuinfo | wc -l`æŸ¥çœ‹ CPU æ ¸æ•°
>
> å¯åŠ¨å worker è¿›ç¨‹çš„ä¸ªæ•°ï¼ˆworker è¿›ç¨‹ä¸ªæ•°ï¼Œä¸€èˆ¬æ˜¯ CPU çš„æ ¸æ•°ï¼Œæˆ–è€… CPU æ ¸æ•°çš„ä¸¤å€ï¼‰,ä¸€ä¸ª CPU å¼€å¯å¤šä¸ªè¿›ç¨‹åè€Œæ•ˆç‡æ›´ä½
>
> æ®å®˜æ–¹è¯´æ³•ï¼Œä¸€èˆ¬å¼€ä¸€ä¸ªå°±å¤Ÿäº†ï¼Œå¤šå¼€å‡ ä¸ªï¼Œå¯ä»¥å‡å°‘æœºå™¨ io å¸¦æ¥çš„å½±å“ã€‚æ®å®è·µè¡¨æ˜ï¼Œnginx çš„è¿™ä¸ªå‚æ•°åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¼€ 4 ä¸ªæˆ– 8 ä¸ªå°±å¯ä»¥äº†ï¼Œå†å¾€ä¸Šå¼€çš„è¯ä¼˜åŒ–ä¸å¤ªå¤§ã€‚

###### events

> ğŸª” **worker_connections**
>
> `worker_connections 1024;` å•ä¸ªä¸šåŠ¡è¿›ç¨‹(Worker)å¯æ¥å—è¿æ¥æ•°

###### http

> ğŸ“¡ **include mime.types**
>
> `include mime.types;` å¼•å…¥ http mime ç±»å‹
>
> `mime.types` è´Ÿè´£å“åº”æ–‡ä»¶çš„ç±»å‹ï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ–‡ä»¶çš„ç±»å‹(ä¼ è¾“ä»¥äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ï¼Œæ— æ³•çŸ¥é“æ–‡ä»¶ç±»å‹)
>
> **è¿”å›çš„æ•°æ®åœ¨å®¢æˆ·ç«¯å°†å¦‚ä½•å¤„ç†(ä¸‹è½½||å±•ç¤º)ï¼Œç”± mime.types å†³å®š(å¹¶ä¸æ˜¯ç”±åç¼€å†³å®š)** `Content-Type: text/css`
>
> **include è¡¨ç¤ºå°†å¦å¤–çš„é…ç½®æ–‡ä»¶å¼•å…¥åˆ°å½“å‰çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç”¨äºå°†å¤æ‚çš„é…ç½®åˆ†å¼€ç®¡ç†**

> ğŸ—¿ **default_type application/octet-stream**
>
> `default_type application/octet-stream;` å¦‚æœ mime ç±»å‹æ²¡åŒ¹é…ä¸Šï¼Œé»˜è®¤ä½¿ç”¨äºŒè¿›åˆ¶æµçš„æ–¹å¼ä¼ è¾“ã€‚

> ğŸ¹ **sendfile on**
>
> `sendfile on;` ä½¿ç”¨ linux çš„ sendfile(socket, file, len) é«˜æ•ˆç½‘ç»œä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯**æ•°æ® 0 æ‹·è´**ã€‚ æœªå¼€å¯ sendfile
>
> å¼€å¯æ—¶ï¼šnginx æ‰¾åˆ°æ–‡ä»¶åä¸éœ€è¦è¯»å–æ‹·è´ä¸€ä»½èµ„æºå†è½¬å‘ç»™ç³»ç»Ÿç½‘ç»œæœåŠ¡æ¥å£è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç›´æ¥è®©ç³»ç»Ÿç½‘ç»œæœåŠ¡æ¥å£è¯»å–è¿”å›ç»™å®¢æˆ·ç«¯
>
> å…³é—­æ—¶ï¼šnginx æ‰¾åˆ°æ–‡ä»¶åéœ€è¦è¯»å–æ‹·è´ä¸€ä»½èµ„æºå†è½¬å‘ç»™ç³»ç»Ÿç½‘ç»œæœåŠ¡æ¥å£ç„¶åå†è¿”å›ç»™å®¢æˆ·ç«¯

> **ğŸ”­ keepalive_timeout**
>
> `keepalive_timeout 65;`ä¿æŒè¿æ¥è¶…æ—¶çš„æ—¶é—´

###### http - server

> **`server`** è™šæ‹Ÿä¸»æœº vhost
>
> **è¡¨ç¤ºä¸€ä¸ªä¸»æœºï¼Œä¸€ä¸ª server ä»£è¡¨ä¸€ä¸ªä¸»æœº(nginx å¯ä»¥è¿è¡Œå¤šä¸ªä¸»æœºï¼Œä¸»æœºä¹‹é—´äº’ç›¸ä¸å¹²æ‰°)ï¼Œé€šè¿‡ç«¯å£å·åŒºåˆ†ä¸åŒçš„ä¸»æœº**

> **ğŸ—œï¸listen**
>
> `listen 80;`ç›‘å¬çš„ç«¯å£å·ï¼Œå½“å‰æœåŠ¡å™¨çš„ç«¯å£å·

> **ğŸ’‰ server_name**
>
> `server_name localhost;`åŸŸå or ä¸»æœºå
>
> ä¸€ä¸ª server ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªã€ä¸»æœºåŸŸåã€‘`server_name`

> **ğŸ›¢ï¸ location**
>
> ```js
> location / {
>          root   html;
>          index  index.html index.htm;
>      }
> ```
>
> åŒ¹é…åŸŸå**`uri`**,å¦‚ï¼Œhttp://location/index.html
>
> ```nginx
> location [=|~|~*|^~] /uri/ {}
> ```
>
> url:http://location/index.html
>
> uri:`/index.html`
>
> åŒ¹é…æ­£ç¡®ï¼š(è¿›å…¥)
>
> `root è·¯å¾„;`ï¼Œlocation çš„ root ç›®å½•ï¼Œè·¯å¾„ç›¸å¯¹äº nginx æ ¹ç›®å½•ä¸‹(ç›¸å¯¹è·¯å¾„)
>
> `index index.html index.htm;`é»˜è®¤é¡µï¼ŒåŒ¹é…çš„ location çš„é»˜è®¤èµ„æº

> **âš–ï¸ error_pag** é”™è¯¯é¡µé¢
>
> ```
>  error_page   500 502 503 504  /50x.html;
>         location = /50x.html {
>             root   html;
>         }
> ```

###### è¯¦ç»†é…ç½®

```
server {
    listen       80;  //ç›‘å¬ç«¯å£ä¸º80ï¼Œå¯ä»¥è‡ªå®šä¹‰å…¶ä»–ç«¯å£ï¼Œä¹Ÿå¯ä»¥åŠ ä¸ŠIPåœ°å€ï¼Œå¦‚ï¼Œlisten 127.0.0.1:8080;
    server_name  localhost; //å®šä¹‰ç½‘ç«™åŸŸåï¼Œå¯ä»¥å†™å¤šä¸ªï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚
    #charset koi8-r; //å®šä¹‰ç½‘ç«™çš„å­—ç¬¦é›†ï¼Œä¸€èˆ¬ä¸è®¾ç½®ï¼Œè€Œæ˜¯åœ¨ç½‘é¡µä»£ç ä¸­è®¾ç½®ã€‚
    #access_log  logs/host.access.log  main; //å®šä¹‰è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥é’ˆå¯¹æ¯ä¸€ä¸ªserverï¼ˆå³æ¯ä¸€ä¸ªç«™ç‚¹ï¼‰è®¾ç½®å®ƒä»¬è‡ªå·±çš„è®¿é—®æ—¥å¿—ã€‚
    ##åœ¨server{}é‡Œæœ‰å¾ˆå¤šlocationé…ç½®æ®µ
    location / {
        root   html;  //å®šä¹‰ç½‘ç«™æ ¹ç›®å½•ï¼Œç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚
        index  index.html index.htm; //å®šä¹‰ç«™ç‚¹çš„é»˜è®¤é¡µã€‚
    }
    #error_page  404              /404.html;  //å®šä¹‰404é¡µé¢
    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;  //å½“çŠ¶æ€ç ä¸º500ã€502ã€503ã€504æ—¶ï¼Œåˆ™è®¿é—®50x.html
    location = /50x.html {
        root   html;  //å®šä¹‰50x.htmlæ‰€åœ¨è·¯å¾„
    }
    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #å®šä¹‰è®¿é—®phpè„šæœ¬æ—¶ï¼Œå°†ä¼šæ‰§è¡Œæœ¬location{}éƒ¨åˆ†æŒ‡ä»¤
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;  //proxy_passåé¢æŒ‡å®šè¦è®¿é—®çš„urlé“¾æ¥ï¼Œç”¨proxy_passå®ç°ä»£ç†ã€‚
    #}
    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;  //å®šä¹‰FastCGIæœåŠ¡å™¨ç›‘å¬ç«¯å£ä¸åœ°å€ï¼Œæ”¯æŒä¸¤ç§å½¢å¼ï¼Œ1 IP:Portï¼Œ 2 unix:/path/to/sockt
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;  //å®šä¹‰SCRIPT_FILENAMEå˜é‡ï¼Œåé¢çš„è·¯å¾„/scriptsä¸ºä¸Šé¢çš„rootæŒ‡å®šçš„ç›®å½•
    #    include        fastcgi_params; //å¼•ç”¨prefix/conf/fastcgi_paramsæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†fastcgiç›¸å…³çš„å˜é‡
    #}
    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {   //è®¿é—®çš„urlä¸­ï¼Œä»¥/.htå¼€å¤´çš„ï¼Œå¦‚ï¼Œwww.example.com/.htaccessï¼Œä¼šè¢«æ‹’ç»ï¼Œè¿”å›403çŠ¶æ€ç ã€‚
    #    deny  all;  //è¿™é‡Œçš„allæŒ‡çš„æ˜¯æ‰€æœ‰çš„è¯·æ±‚ã€‚
    #}
}
# another virtual host using mix of IP-, name-, and port-based configuration
#
#server {
#    listen       8000;  //ç›‘å¬8000ç«¯å£
#    listen       somename:8080;  //æŒ‡å®šip:port
#    server_name  somename  alias  another.alias;  //æŒ‡å®šå¤šä¸ªserver_name
#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}
# HTTPS server
#
#server {
#    listen       443 ssl;  //ç›‘å¬443ç«¯å£ï¼Œå³ssl
#    server_name  localhost;
### ä»¥ä¸‹ä¸ºsslç›¸å…³é…ç½®
#    ssl_certificate      cert.pem;    //æŒ‡å®špemæ–‡ä»¶è·¯å¾„
#    ssl_certificate_key  cert.key;  //æŒ‡å®škeyæ–‡ä»¶è·¯å¾„
#    ssl_session_cache    shared:SSL:1m;  //æŒ‡å®šsession cacheå¤§å°
#    ssl_session_timeout  5m;  //æŒ‡å®šsessionè¶…æ—¶æ—¶é—´
#    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   //æŒ‡å®šsslåè®®
#    ssl_ciphers  HIGH:!aNULL:!MD5;  //æŒ‡å®šsslç®—æ³•
#    ssl_prefer_server_ciphers  on;  //ä¼˜å…ˆé‡‡å–æœåŠ¡å™¨ç®—æ³•
#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}
```

## åŸŸåè§£æ

ä½¿ç”¨ host æ–‡ä»¶è§£æåŸŸå(æœ¬åœ°åŸŸåè§£æ)ï¼Œåœ¨`C:\Windows\System32\drivers\etc`ç›®å½•ä¸‹ï¼Œå¤‡ä»½ä¸€ä»½ hosts æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š

```
# localhost name resolution is handled within DNS itself.
#	127.0.0.1       localhost
#	::1             localhost
127.0.0.1       activate.navicat.com
```

`#` 127.0.0.1(ip åœ°å€) localhost(ä¸»æœºå or åŸŸå)

**é…ç½®è™šæ‹Ÿæœºçš„åŸŸå**

**1ã€ä¿®æ”¹ hosts æ–‡ä»¶çš„æ“ä½œæƒé™**

> å³é”® hosts æ–‡ä»¶å±æ€§ï¼Œå¸¸è§„å–æ¶ˆå‹¾é€‰åªè¯»ï¼Œèµ‹äºˆ users æƒé™,è¿›è¡Œä¿®æ”¹
>
> ä¿®æ”¹å®Œæˆåéœ€è¦è¿˜åŸé»˜è®¤æƒé™ï¼Œé˜²æ­¢ç¬¬ä¸‰æ–¹è½¯ä»¶æ›´æ”¹æ­¤æ–‡ä»¶
>
> ä¿®æ”¹ hosts åéœ€è¦åˆ·æ–° DNS ç¼“å­˜ä½¿ä¹‹ç”Ÿæ•ˆ,åœ¨ cmd å‘½ä»¤è¡Œä¸­æ‰§è¡Œå‘½ä»¤ï¼šipconfig/flushdns
>
> æµ‹è¯• cmd ping åŸŸå

> **æœ¬åœ° host æ–‡ä»¶å’Œ nginx æ˜ å°„çš„å…³ç³»**
>
> é¦–å…ˆï¼Œå®¢æˆ·ç«¯é€šè¿‡åŸŸåè¯·æ±‚æœåŠ¡ï¼Œå¦‚æœä½ åœ¨æœ¬åœ°çš„ hosts æ–‡ä»¶ä¸­é…ç½®äº†è¯¥åŸŸåä¸ ip çš„æ˜ å°„å…³ç³»ï¼Œé‚£ä¹ˆï¼Œè¯·æ±‚å°±ä¼šç›´æ¥å‘é€åˆ° hosts æ–‡ä»¶ä¸­å¯¹åº”çš„ ipï¼Œä¸ä¼šé€šè¿‡ dns è§£æï¼ˆå¦‚æœæœ¬åœ° hosts æ–‡ä»¶ä¸­æ²¡æœ‰é…ç½®ï¼Œå°±ä¼šé€šè¿‡ dns è§£æåŸŸåï¼‰ã€‚
> è¿™æ—¶ï¼Œè¯·æ±‚åˆ°è¾¾äº†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯çš„ nginx æ‹¦æˆªäº†è¯¥è¯·æ±‚ï¼Œç„¶ååœ¨æœ¬åœ°**é€šè¿‡åŸŸååŒ¹é… server_nameï¼Œç„¶åï¼Œæ ¹æ® proxy_pass è¿”å›ç›¸åº”çš„æœåŠ¡ç»™å®¢æˆ·ç«¯ã€‚**

## Nginx è™šæ‹Ÿä¸»æœºåŸŸåé…ç½®

**1ã€åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º `www` ç›®å½•å­˜æ”¾ç«™ç‚¹èµ„æº**

`cd /` `mkdir www` `cd /www/`

2ã€åˆ†åˆ«åˆ›å»ºç«™ç‚¹ç›®å½•ï¼ŒåŒºåˆ†ç®¡ç†ç«™ç‚¹

`mkdir www` ä¸»ç«™ç‚¹

`mkdir video` è§†é¢‘ç«™ç‚¹

**3ã€åœ¨ç«™ç‚¹ä¸Šåˆ›å»ºä¸»é¡µé¢(é»˜è®¤é¡µ index.html)**

`cd www` - `vi index.html` - `ç¼–è¾‘æ•°æ®`

`... ...`

**4ã€åœ¨ nginx é…ç½® nginx.conf ä¸‹è¿›è¡Œé…ç½®ä¿®æ”¹**

é…ç½®å•ç‹¬çš„è™šæ‹Ÿä¸»æœºç«™ç‚¹(wwwã€video),`åœ¨ http æ¨¡å—ä¸‹`ï¼Œé…ç½®å®Œæˆï¼Œ**reload** ä¸‹

`systemctl reload nginx`

`systemctl status nginx`(æŸ¥çœ‹çŠ¶æ€æ˜¯å¦é‡å¯)

```
 # wwwä¸»æœºç«™ç‚¹ ------ âš–ï¸å¦‚æœå…¶å®ƒç«™ç‚¹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªç«™ç‚¹ ------
 server {
 		# 80ç«¯å£
        listen       80;
        #server_name  localhost;
        server_name  www.web-u.top;

        location / {
	 	   root   /www/www;
           index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
```

```
 # videoä¸»æœºç«™ç‚¹
 server {
 		# 88ç«¯å£
        #listen       88;
        listen       80;
        #server_name  localhost;
        server_name  video.web-u.top;

        location / {
	 	   root   /www/video;
           index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
```

> **åœ¨ç«¯å£å·ç›¸åŒæƒ…å†µä¸‹ï¼Œé€šè¿‡ä¸»æœºåŸŸååŒºåˆ†ä¸»æœºç«™ç‚¹ server_name**(**`ä¸»æœºåä¸ç«¯å£å·ç»„åˆéœ€è¦å…¨å±€å”¯ä¸€`**)
>
> ä¿®æ”¹ server_name `server_name www.web-u.top` `server_name video.web-u.top`

## server_name åŒ¹é…è§„åˆ™

> **`ğŸª• è§£å†³ã€Nginx è™šæ‹Ÿä¸»æœºåŸŸåé…ç½®ã€‘ä¸­ï¼Œå¤šä¸ªä¸åŒèµ„æºéœ€è¦é…ç½®å¤šä¸ªä¸åŒ server è™šæ‹Ÿä¸»æœºç«™ç‚¹çš„ç¼ºç‚¹`**
>
> ğŸ›¢ï¸ ä¸€ä¸ª server ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªã€ä¸»æœºåŸŸåã€‘`server_name`
>
> ğŸ”­ å½“æœ€ä¸Šå±‚çš„è™šæ‹Ÿä¸»æœºè¢«åŒ¹é…æ­£ç¡®æ—¶ï¼Œ**åé¢çš„åˆ™ä¸å†åŒ¹é…**
>
> âš–ï¸ æ”¯æŒ**é€šé…ç¬¦**åŒ¹é… ` server_name *.web-u.top;` or `server_name www.web-u.*;`
>
> ğŸ¹ æ­£åˆ™åŒ¹é…(é€‚ç”¨äºäºŒçº§åŸŸååŒ¹é…)ï¼ŒäºŒçº§åŸŸå.web-u.top:æ•°å­—å¼€å¤´ `~^[0-9]+\.web-u\.com$;`

```
server {
        listen       80;
        #server_name  localhost;
        #ä¸€ä¸ªè™šæ‹Ÿä¸»æœºç«™ç‚¹é…ç½®å¤šä¸ªåŸŸåä¸»æœºå(æ³¨æ„ä¹‹é—´çš„ç©ºæ ¼)ğŸª”
        server_name  www.web-u.top ng.web-u.top;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
	 		root   /www/www;
            index  index.html index.htm;
        }
    }
```

## æ­£å‘ä»£ç†ä¸åå‘ä»£ç†

### æ­£å‘

> **ğŸ’» å½“ç”¨æˆ·è®¿é—®å¤–ç½‘ï¼Œå¦‚è°·æ­Œå•†åŸï¼Œç”¨æˆ·æ˜¯æ— æ³•ç›´æ¥è®¿é—®åˆ°å¤–ç½‘çš„è°·æ­Œçš„ï¼Œ`æ­¤æ—¶ç”¨æˆ·éœ€è¦å€ŸåŠ©ä¸€ä¸ªä»£ç†æœåŠ¡å™¨(æ­£å‘)`ï¼Œå°†è¯·æ±‚ä»£ç†ç»™å¤–ç½‘ï¼Œå¤–ç½‘è¿”å›èµ„æºç»™ä»£ç†æœåŠ¡å™¨ï¼Œå†å°†èµ„æºè¿”å›ç”¨æˆ·ï¼Œè¿™å°±æ˜¯æ­£å‘ä»£ç†**
>
> è¿™ä¸ªä»£ç†æœåŠ¡**ä»£ç†çš„æ˜¯å®¢æˆ·ç«¯**çš„ï¼Œæ˜¯å®¢æˆ·ç«¯éœ€è¦è¯·æ±‚çš„ï¼Œå®¢æˆ·ç«¯åˆ™éœ€è¦èµ·ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå»è¯·æ±‚æ•°æ®ã€å®¢æˆ·ç«¯ä¸ä»£ç†æœåŠ¡å™¨æ˜¯ä¸€ä½“ã€‘ï¼Œ**`å®¢æˆ·ç«¯è‡ªå·±ä¸»åŠ¨æä¾›ä¸€ä¸ªä»£ç†`**
>
> ![image-20220918130055899](/img/image-20220918130055899.png)

### åå‘

> **ğŸŒ å½“ç”¨æˆ·éœ€è¦è®¿é—®åå°æœåŠ¡èµ„æºæ—¶ï¼Œç”¨æˆ·æ˜¯ã€æ— æ³•ç›´æ¥è®¿é—®ã€‘çš„åˆ°ï¼Œåå°æœåŠ¡'æ— æ³•ç›´æ¥è¢«ç”¨æˆ·è®¿é—®'ï¼Œ`æ­¤æ—¶åå°éœ€è¦å€ŸåŠ©ä¸€ä¸ªä»£ç†æœåŠ¡å™¨(åå‘)`ï¼Œå¸®åŠ©ç”¨æˆ·å¯ä»¥è®¿é—®åˆ°å®ƒï¼Œåæ–¹å‘èµ·ä¸€ä¸ªä»£ç†ï¼Œã€ä»£ç†å¯¹è±¡ä¸ºåå°æœåŠ¡ã€‘,ä»£ç†æœåŠ¡è·å–ç”¨æˆ·è¯·æ±‚å†å°†è¯·æ±‚ç»™åˆ°åå°(ä»£ç†æœåŠ¡ä¸åå°æ˜¯å¯ä»¥è®¿é—®çš„)ï¼Œåå°å†å°†èµ„æºå“åº”ç»™ä»£ç†ï¼Œå†å“åº”å›ç»™ç”¨æˆ·(ä»£ç†ä¸ç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥è®¿é—®åˆ°çš„)**
>
> åå°æœåŠ¡å™¨ä¸ä»£ç†æ˜¯ä¸€ä½“ï¼Œ**`åå°æœåŠ¡å™¨ä¸»åŠ¨åå‘æä¾›ä¸€ä¸ªä»£ç†ç»™å®¢æˆ·ç«¯è®¿é—®`**
>
> ![image-20220918131838848](/img/image-20220918131838848.png)
>
> éš§é“å¼ä»£ç†ï¼šä¸€è¿›ä¸€å‡ºéƒ½ç»è¿‡ nginx å¤„ç†å“åº”
>
> lvs(DR)å¼ä»£ç†ï¼šç”± nginx è¿›ï¼Œç›´æ¥ç”±åå°æœåŠ¡å“åº”æ•°æ®è¿”å›å®¢æˆ·ç«¯

## åå‘ä»£ç†é…ç½®

1ã€ç«¯å£è½¬å‘

> `proxy_pass`
>
> ä¸¤ç§é…ç½®æ ¼å¼ï¼š
>
> **1ã€ä¸€å°å…·ä½“çš„ä¸»æœº or ç½‘å€**
>
> é…ç½®ä¸ºç½‘å€æ—¶ï¼Œ`åè®®æ ¼å¼å¿…é¡»ä¹¦å†™å®Œæ•´`ï¼Œ`proxy_pass http://juejin.cn/;`
>
> **ä¸æ”¯æŒåå‘ä»£ç†è½¬å‘åˆ° `https` çš„ç½‘ç«™æœåŠ¡**,éœ€è¦ä¸è¯ä¹¦é…ç½®å¯¹åº”æ­£ç¡®
>
> åè®®ä¹¦å†™æ–¹å¼ä¸æ­£ç¡®ï¼š`http://`ç¼ºå°‘ wwwï¼Œåˆ™ä¸ºä¸€ä¸ªé‡å®šå‘è¯·æ±‚(301ã€302)
>
> `http://www`ï¼Œåˆ™ä¸ºä¸€ä¸ªæ­£ç¡®çš„è¯·æ±‚è½¬å‘(200)
>
> çœŸæ­£è½¬å‘æˆåŠŸæ—¶ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨çš„åœ°å€é‡Œé¢ä¸ºè¯·æ±‚ç»™ nginx çš„åœ°å€`web-u.top`ï¼Œè€Œä¸æ˜¯è½¬å‘åçš„åœ°å€`juejin.cn`è½¬å‘åçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç»è¿‡ nginxï¼Œåä¹‹ä¸ºé‡å®šå‘çš„è¯ï¼Œnginx ä¸ä¼šå†æ•è·åˆ°é‡å®šå‘åçš„è¯·æ±‚ä¿¡æ¯
>
> **`root ä¸ proxy_passåªèƒ½äºŒé€‰ä¸€`**
>
> ```
> location / {
> 	#proxy_pass   http://juejin.cn/;ä¸æ”¯æŒ åé¢ä¹Ÿä¼šè·³è½¬åˆ°httpsä¸Š
> 	proxy_pass   http://www.atguigu.com;
> 	#root   html;
>           index  index.html index.htm;
>     }
> ```
>
> **2ã€ä¸€ç»„æœåŠ¡å™¨`**

> **åœ¨ nginx ä¸­é…ç½® proxy_pass ä»£ç†è½¬å‘æ—¶ï¼Œå¦‚æœåœ¨ proxy_pass åé¢çš„ url åŠ /ï¼Œè¡¨ç¤ºç»å¯¹æ ¹è·¯å¾„ï¼›`å¦‚æœæ²¡æœ‰/ï¼Œè¡¨ç¤ºç›¸å¯¹è·¯å¾„ï¼ŒæŠŠåŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¹Ÿç»™ä»£ç†èµ°`**
>
> ```
> å‡è®¾ä¸‹é¢å››ç§æƒ…å†µåˆ†åˆ«ç”¨ http://192.168.1.1/proxy/test.html è¿›è¡Œè®¿é—®ã€‚
>
> ç¬¬ä¸€ç§ï¼š
> location /proxy/ {
> proxy_pass http://127.0.0.1/;
> }
> ä»£ç†åˆ°URLï¼šhttp://127.0.0.1/test.html
>
> ç¬¬äºŒç§ï¼ˆç›¸å¯¹äºç¬¬ä¸€ç§ï¼Œæœ€åå°‘ä¸€ä¸ª / ï¼‰
> location /proxy/ {
> proxy_pass http://127.0.0.1;
> }
> ä»£ç†åˆ°URLï¼šhttp://127.0.0.1/proxy/test.html
>
> ç¬¬ä¸‰ç§ï¼š
> location /proxy/ {
> proxy_pass http://127.0.0.1/aaa/;
> }
> ä»£ç†åˆ°URLï¼šhttp://127.0.0.1/aaa/test.html
>
> ç¬¬å››ç§ï¼ˆç›¸å¯¹äºç¬¬ä¸‰ç§ï¼Œæœ€åå°‘ä¸€ä¸ª / ï¼‰
> location /proxy/ {
> proxy_pass http://127.0.0.1/aaa;
> }
> ä»£ç†åˆ°URLï¼šhttp://127.0.0.1/aaatest.html
> ```

## è´Ÿè½½å‡è¡¡

> ğŸŒ é…ç½®ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº `192.168.254.8`nginx_1 `192.168.254.18`nginx_2
>
> è´Ÿè½½å‡è¡¡ï¼šnginx è™šæ‹ŸæœåŠ¡å™¨`192.168.254.88`(è´Ÿè½½å‡è¡¡å™¨)å°†ä¸Šé¢ä¸¤å°é…ç½®çš„è™šæ‹Ÿä¸»æœºåä»£ç†ï¼Œä¹‹å**`è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¸€ä¼šè®¿é—®åˆ° nginx_1,ä¸€ä¼šè®¿é—®åˆ° nginx_2`**

**1ã€é…ç½®ä»£ç†è½¬å‘(è½¬å‘ä¸ºä¸€ç»„é›†ç¾¤æœåŠ¡å™¨)**

é›†ç¾¤ï¼šä¸€ç¾¤æ¯ä¸€ä¸ªåŠŸèƒ½ä¸€æ ·ç›¸ä¼¼çš„æœåŠ¡å™¨

```
 location / {
 	# è¡¨ç¤ºå°†æ‰€æœ‰è¯·æ±‚è½¬å‘åˆ° httpds æœåŠ¡å™¨é›†ç¾¤ç»„ä¸­é…ç½®çš„æŸä¸€å°æœåŠ¡å™¨ä¸ŠğŸ’»ğŸ’»ğŸ’»
	proxy_pass   http://httpds;
	#root   html;
    index  index.html index.htm;
  }
```

**2ã€é…ç½® upstream æ¨¡å—(ä¸ server åŒçº§)**

`upstream ä»£ç†è½¬å‘é›†ç¾¤åˆ«å(httpds)`

**3ã€é…ç½®æœåŠ¡å™¨ä¸»æœºé›†ç¾¤**

**`æ­¤æ–¹æ³•ä¸ºè½®è¯¢ç­–åˆ—(é»˜è®¤) ğŸ§«`**ï¼Œå¯¹äºæ¯ä¸ªæœåŠ¡å™¨é…ç½®å‡ç­‰æƒ…å†µä¸‹æ¯”è¾ƒå¥½çš„ç­–åˆ—(é…ç½®ä¸ä¸€ï¼Œé…ç½®ä½ä¸é…ç½®é«˜è·å¾—ç›¸åŒçš„å¤„ç†æ¬¡æ•°)

ç«¯å£å¯é€‰ï¼Œä¸é…ç½®é»˜è®¤ä½¿ç”¨ 80 ç«¯å£

```c
upstream httpds {
	# nginx_1
	server 192.168.254.8:80;
	# nginx_2
	server 192.168.254.18:80;
   }
```

### è´Ÿè½½å‡è¡¡ç­–ç•¥è§„åˆ™

**æƒé‡(è¶Šé«˜åˆ†é…è¶Šå¤š)**

é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼ŒNginx é»˜è®¤å°†è¯·æ±‚ä¾æ¬¡åˆ†é…ç»™ 100ï¼Œ101ï¼Œ102 æ¥å¤„ç†ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ä¸‹é¢è¿™äº›å‚æ•°æ¥æ”¹å˜é»˜è®¤çš„åˆ†é…ç­–ç•¥ï¼š
weight é»˜è®¤ä¸º 1ï¼Œå°†è¯·æ±‚å¹³å‡åˆ†é…ç»™æ¯å° server

```c
upstream tomcats {
 server 192.168.0.100:8080 weight=2;  # 2/6æ¬¡
 server 192.168.0.101:8080 weight=3;  # 3/6æ¬¡
 server 192.168.0.102:8080 weight=1;  # 1/6æ¬¡
}
# æ›´å¤šé…ç½®  max_fails=3 fail_timeout=15
```

**backup å¤‡ä»½æœº**

æ‰€æœ‰æœåŠ¡å™¨æŒ‚äº†ä¹‹åæ‰ä¼šç”Ÿæ•ˆ

`server 192.168.0.100:8080 backup;`

---

**ä¸å¸¸ç”¨çš„ï¼š**

**1ã€down æ ‡è¯†æŸä¸€å° server ä¸å¯ç”¨ï¼Œä¸å‚ä¸è´Ÿè½½å‡è¡¡(ä¼‘æ¯)**

`server 192.168.0.100:8080 down;`

ç”Ÿäº§ç¯å¢ƒä¸å¸¸ç”¨ï¼š

**2ã€ip_hash**

éš¾ä»¥ä¿è¯ ip åœ°å€ç›¸åŒä¸å˜(æ¯”å¦‚ç§»åŠ¨ç«¯æ‰‹æœº)

###### **ç™»å½•éªŒè¯åœºæ™¯**

> åœ¨ç”¨æˆ·è¯·æ±‚åå°æœåŠ¡ç™»å½•æ—¶ï¼Œè½®è¯¢æœåŠ¡å™¨é›†ç¾¤ï¼Œç™»å½•éªŒè¯æˆåŠŸåä¿¡æ¯å­˜åœ¨å¤„ç†å½“å‰è¯·æ±‚çš„é‚£å°æœåŠ¡å™¨ï¼Œä¸‹æ¬¡è®¿é—®å…¶å®ƒçš„é›†ç¾¤æœåŠ¡å™¨æ€ä¹ˆåŠï¼Œæ€ä¹ˆä¿æŒä¸ç”¨æˆ·çš„ä¼šè¯ï¼Ÿ
>
> **`1ã€ç”¨ token å­˜å‚¨äºå®¢æˆ·ç«¯å¯ä»¥è§£å†³(JWT)`**ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ
>
> **`2ã€ip_hash`**ï¼Œ**æ ¹æ®å®¢æˆ·ç«¯çš„åœ°å€ï¼Œè®©å…¶ä¿æŒä¸åŒä¸€å°æœåŠ¡å™¨ä¼šè¯(æˆåŠŸéªŒè¯åçš„æœåŠ¡å™¨)**
>
> 3ã€æ— çŠ¶æ€çš„ ä¼šè¯ session(SpringSession)

> **token å­˜å‚¨äºå®¢æˆ·ç«¯è§£å†³åŸç†**ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ
>
> ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚åˆ° nginx æœåŠ¡å™¨ï¼Œnginx æœåŠ¡å™¨ä¼šæ‰¾åˆ°ä¸€å°**ä¸“é—¨ç”¨äºæƒé™æ ¡éªŒçš„æœåŠ¡å™¨**ï¼Œè¿”å› token å®¢æˆ·ç«¯å‚¨å­˜(token ä¸ºä¸¤æ–¹åŠ å¯†çš„ä¸€ç§èº«ä»½éªŒè¯ä»¤ç‰Œ)ï¼Œå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Š token ï¼ŒæœåŠ¡å™¨è§£å¼€éªŒè¯(token è¢«ç¯¡æ”¹ä¹‹å token æ˜¯è§£ä¸å¼€çš„)

**3ã€least_conn æœ€å°‘è¿æ¥æ•°**

(ä¸åˆç†)

```
# å®šä¹‰è½¬å‘åˆ†é…è§„åˆ™
upstream httpds {
	least_conn; # æŠŠè¯·æ±‚åˆ†æ´¾ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨
	server srv1.com;
	server srv2.com:8088;
	server 192.168.0.100:8088;
}
```

**4ã€fair ç¬¬ä¸‰æ–¹è´Ÿè½½ç­–ç•¥**

æ ¹æ®æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ï¼Œå³è´Ÿè½½å‹åŠ›å°çš„ä¼˜å…ˆä¼šåˆ†é…(ä¸åˆç†ï¼šå®¹æ˜“é€ æˆæµé‡å€¾æ–œ)

**5ã€url_hash ç¬¬ä¸‰æ–¹**

å®šå‘æµé‡è½¬å‘(é€‚ç”¨äºè®¿é—®å›ºå®šèµ„æºï¼Œä¸å¤ªåŒä¸€æœåŠ¡å™¨çš„èµ„æº)

## å…¶å®ƒ

### net-tools

å®‰è£… net-tools æ¥æŸ¥çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µï¼š`yum -y install net-tools`

net-tools å·¥å…·ç®±åŒ…æ‹¬[arpopen in new window](https://so.csdn.net/so/search?q=arp&spm=1001.2101.3001.7020), hostname, ifconfig, netstat, rarp, route, plipconfig, slattach, mii-tool and iptunnel and ipmaddr ç­‰å‘½ä»¤ã€‚

æŸ¥çœ‹ç«¯å£ä½¿ç”¨

```bash
netstat -nplt
```
