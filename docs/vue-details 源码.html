<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://kiyan-a.github.io/sev/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html"><meta property="og:site_name" content="K"><meta property="og:title" content="Vue"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-11-08T14:32:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-11-08T14:32:31.000Z"><link rel="icon" type="svg" href="/logo.svg"><title>Vue | K</title><meta name="description" content="记录成长,相信过程...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/docs/assets/style.0d78e735.css">
    <link rel="modulepreload" href="/docs/assets/app.4ddfd4cd.js"><link rel="modulepreload" href="/docs/assets/vue-details 源码.html.8ccd6020.js"><link rel="modulepreload" href="/docs/assets/vue-details 源码.html.b752ae5f.js"><link rel="prefetch" href="/docs/assets/index.html.f5dd38ac.js"><link rel="prefetch" href="/docs/assets/exhibition.html.c7a89bd0.js"><link rel="prefetch" href="/docs/assets/article1.html.b6f368df.js"><link rel="prefetch" href="/docs/assets/article2.html.dfa3f786.js"><link rel="prefetch" href="/docs/assets/Axios封装.html.0d4a89d1.js"><link rel="prefetch" href="/docs/assets/ES6.html.e471b51d.js"><link rel="prefetch" href="/docs/assets/about.html.4f7c1c10.js"><link rel="prefetch" href="/docs/assets/accuracyProblem.html.663f4a84.js"><link rel="prefetch" href="/docs/assets/dev.html.528e106e.js"><link rel="prefetch" href="/docs/assets/disable.html.9b3a36e1.js"><link rel="prefetch" href="/docs/assets/for Js.html.2ccd5b0c.js"><link rel="prefetch" href="/docs/assets/markdown.html.c1569dc6.js"><link rel="prefetch" href="/docs/assets/mate.html.72ae4231.js"><link rel="prefetch" href="/docs/assets/nest.html.9d980397.js"><link rel="prefetch" href="/docs/assets/new Linux.html.f80b0124.js"><link rel="prefetch" href="/docs/assets/uni-app.html.ff3a7e0b.js"><link rel="prefetch" href="/docs/assets/vite.html.8c6355e5.js"><link rel="prefetch" href="/docs/assets/vue3.html.772fa207.js"><link rel="prefetch" href="/docs/assets/webpack.html.f45c918a.js"><link rel="prefetch" href="/docs/assets/开发规范.html.aeb36f22.js"><link rel="prefetch" href="/docs/assets/文件资源处理.html.9dfa65ef.js"><link rel="prefetch" href="/docs/assets/index.html.9bd4fde8.js"><link rel="prefetch" href="/docs/assets/index.html.16ef35e4.js"><link rel="prefetch" href="/docs/assets/disable.html.4262b987.js"><link rel="prefetch" href="/docs/assets/encrypt.html.9cb1df49.js"><link rel="prefetch" href="/docs/assets/markdown.html.d9f34491.js"><link rel="prefetch" href="/docs/assets/page.html.bc7733b7.js"><link rel="prefetch" href="/docs/assets/404.html.67a54621.js"><link rel="prefetch" href="/docs/assets/index.html.6bb212ad.js"><link rel="prefetch" href="/docs/assets/index.html.933b48b1.js"><link rel="prefetch" href="/docs/assets/index.html.f325fe48.js"><link rel="prefetch" href="/docs/assets/index.html.e79b2fec.js"><link rel="prefetch" href="/docs/assets/index.html.6b0490c9.js"><link rel="prefetch" href="/docs/assets/index.html.273f2371.js"><link rel="prefetch" href="/docs/assets/index.html.b73cffd4.js"><link rel="prefetch" href="/docs/assets/index.html.0bc2113b.js"><link rel="prefetch" href="/docs/assets/index.html.1c609236.js"><link rel="prefetch" href="/docs/assets/index.html.ca6e47e4.js"><link rel="prefetch" href="/docs/assets/index.html.92e0a1cf.js"><link rel="prefetch" href="/docs/assets/index.html.2e28146c.js"><link rel="prefetch" href="/docs/assets/index.html.3c81acc3.js"><link rel="prefetch" href="/docs/assets/index.html.f592b8c2.js"><link rel="prefetch" href="/docs/assets/index.html.dcea69d7.js"><link rel="prefetch" href="/docs/assets/index.html.7c169c44.js"><link rel="prefetch" href="/docs/assets/index.html.64497277.js"><link rel="prefetch" href="/docs/assets/index.html.2cf1837f.js"><link rel="prefetch" href="/docs/assets/exhibition.html.92a863a1.js"><link rel="prefetch" href="/docs/assets/article1.html.8e9e72c2.js"><link rel="prefetch" href="/docs/assets/article2.html.e9ae525a.js"><link rel="prefetch" href="/docs/assets/Axios封装.html.2097d37c.js"><link rel="prefetch" href="/docs/assets/ES6.html.17ed64fb.js"><link rel="prefetch" href="/docs/assets/about.html.d04ff1c4.js"><link rel="prefetch" href="/docs/assets/accuracyProblem.html.b966a765.js"><link rel="prefetch" href="/docs/assets/dev.html.aef6b112.js"><link rel="prefetch" href="/docs/assets/disable.html.a30ff643.js"><link rel="prefetch" href="/docs/assets/for Js.html.727aa995.js"><link rel="prefetch" href="/docs/assets/markdown.html.f2b9db12.js"><link rel="prefetch" href="/docs/assets/mate.html.ed649eed.js"><link rel="prefetch" href="/docs/assets/nest.html.061a8959.js"><link rel="prefetch" href="/docs/assets/new Linux.html.cea3ca1d.js"><link rel="prefetch" href="/docs/assets/uni-app.html.d3c7e450.js"><link rel="prefetch" href="/docs/assets/vite.html.e7565562.js"><link rel="prefetch" href="/docs/assets/vue3.html.2ab4f6e7.js"><link rel="prefetch" href="/docs/assets/webpack.html.cbf125ad.js"><link rel="prefetch" href="/docs/assets/开发规范.html.3383673d.js"><link rel="prefetch" href="/docs/assets/文件资源处理.html.5f4bf217.js"><link rel="prefetch" href="/docs/assets/index.html.ba6f4fe4.js"><link rel="prefetch" href="/docs/assets/index.html.760cda5f.js"><link rel="prefetch" href="/docs/assets/disable.html.9a2e30a2.js"><link rel="prefetch" href="/docs/assets/encrypt.html.1f225bac.js"><link rel="prefetch" href="/docs/assets/markdown.html.e1043843.js"><link rel="prefetch" href="/docs/assets/page.html.b9c69c16.js"><link rel="prefetch" href="/docs/assets/404.html.c4517191.js"><link rel="prefetch" href="/docs/assets/index.html.6a313bda.js"><link rel="prefetch" href="/docs/assets/index.html.6f016ddd.js"><link rel="prefetch" href="/docs/assets/index.html.cafa9d38.js"><link rel="prefetch" href="/docs/assets/index.html.27652804.js"><link rel="prefetch" href="/docs/assets/index.html.53d408f3.js"><link rel="prefetch" href="/docs/assets/index.html.0557a2aa.js"><link rel="prefetch" href="/docs/assets/index.html.f60d8894.js"><link rel="prefetch" href="/docs/assets/index.html.4ee8e38c.js"><link rel="prefetch" href="/docs/assets/index.html.01b0303d.js"><link rel="prefetch" href="/docs/assets/index.html.74f8235e.js"><link rel="prefetch" href="/docs/assets/index.html.585712a1.js"><link rel="prefetch" href="/docs/assets/index.html.6853050a.js"><link rel="prefetch" href="/docs/assets/index.html.b9445087.js"><link rel="prefetch" href="/docs/assets/index.html.5a4cdc76.js"><link rel="prefetch" href="/docs/assets/index.html.7c5a19a6.js"><link rel="prefetch" href="/docs/assets/index.html.e92b39aa.js"><link rel="prefetch" href="/docs/assets/index.html.e784167c.js"><link rel="prefetch" href="/docs/assets/404.d0fb624d.js"><link rel="prefetch" href="/docs/assets/Layout.4c5fb240.js"><link rel="prefetch" href="/docs/assets/Slide.86c9d9fb.js"><link rel="prefetch" href="/docs/assets/Blog.8ef26a60.js"><link rel="prefetch" href="/docs/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/docs/assets/index.daae04bf.js"><link rel="prefetch" href="/docs/assets/index.1842ee54.js"><link rel="prefetch" href="/docs/assets/mermaid.esm.min.d8b76e20.js"><link rel="prefetch" href="/docs/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/docs/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/docs/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/docs/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/docs/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/docs/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/docs/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/docs/assets/photoswipe.esm.92018b73.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/docs/" class="brand"><img class="logo" src="/docs/logo.svg" alt="K"><!----><span class="site-name hide-in-pad">K</span></a><!----></div><div class="navbar-center"><!----><!----><!----></div><div class="navbar-right"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/docs/docs/about.html" class="nav-link" aria-label="🎉文档"><!---->🎉文档<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="🪂组件"><span class="title"><!---->🪂组件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/components/article1.html" class="nav-link" aria-label="文章 1"><span class="icon iconfont icon-edit" style=""></span>文章 1<!----></a></li><li class="dropdown-item"><a href="/docs/components/article2.html" class="nav-link" aria-label="文章 2"><span class="icon iconfont icon-edit" style=""></span>文章 2<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/log/" class="nav-link" aria-label="🪵更新日志"><!---->🪵更新日志<!----></a></div></nav><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><div class="nav-item"><a class="repo-link" href="https://github.com/Kiyan-a" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><a href="/docs/docs/" class="title">🎉文档</a><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/docs/docs/disable.html" class="nav-link sidebar-link sidebar-page" aria-label="布局与功能禁用"><span class="icon iconfont icon-config" style=""></span>布局与功能禁用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/markdown.html" class="nav-link sidebar-link sidebar-page" aria-label="Markdown 展示"><span class="icon iconfont icon-markdown" style=""></span>Markdown 展示<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/for%20Js.html" class="nav-link sidebar-link sidebar-page" aria-label="✍️ JS 技巧"><!---->✍️ JS 技巧<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/accuracyProblem.html" class="nav-link sidebar-link sidebar-page" aria-label="✍️ JS 精度问题"><!---->✍️ JS 精度问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="✍️ 文件资源处理"><!---->✍️ 文件资源处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/mate.html" class="nav-link sidebar-link sidebar-page" aria-label="👑 新的 Vue 项目"><!---->👑 新的 Vue 项目<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/ES6.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 ES6"><!---->📖 ES6<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/nest.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 NestJs"><!---->📖 NestJs<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/new%20Linux.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 Nginx"><!---->📖 Nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/uni-app.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 uni-app"><!---->📖 uni-app<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/vite.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 Vite 基本使用"><!---->📖 Vite 基本使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/vue3.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 Vue 3"><!---->📖 Vue 3<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/Axios%E5%B0%81%E8%A3%85.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 基于 typescript 二次封装 axios"><!---->📖 基于 typescript 二次封装 axios<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/dev.html" class="nav-link sidebar-link sidebar-page" aria-label="📖 调试技巧"><!---->📖 调试技巧<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/about.html" class="nav-link sidebar-link sidebar-page" aria-label="🦚 关于"><!---->🦚 关于<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/webpack.html" class="nav-link sidebar-link sidebar-page" aria-label="🛠️ Webpack"><!---->🛠️ Webpack<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/docs/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83.html" class="nav-link sidebar-link sidebar-page" aria-label="🛠️ 开发规范"><!---->🛠️ 开发规范<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Vue"><!---->Vue<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#读源码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="读源码"><!---->读源码<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#options-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="options Api"><!---->options Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#methods-中的方法-this-指向" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Methods 中的方法 this 指向"><!---->Methods 中的方法 this 指向<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#computed-简写-与-完整写法的处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="computed 简写 与 完整写法的处理"><!---->computed 简写 与 完整写法的处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#watch-监听器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="watch 监听器"><!---->watch 监听器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#依赖注入-provide-inject" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="依赖注入 provide inject"><!---->依赖注入 provide inject<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#composition-api-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="composition Api"><!---->composition Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🪂-setup" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🪂 setup"><!---->🪂 setup<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍟-reactive-响应式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🍟 reactive 响应式"><!---->🍟 reactive 响应式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍳-ref-响应式-官方-推荐尽量使用-ref-而不是-reactive" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🍳 ref 响应式(官方：推荐尽量使用 ref 而不是 reactive)"><!---->🍳 ref 响应式(官方：推荐尽量使用 ref 而不是 reactive)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍃-readonly-只读" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🍃 readonly 只读"><!---->🍃 readonly 只读<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🚀-reactive-判断-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🚀 Reactive 判断 Api"><!---->🚀 Reactive 判断 Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🛵-torefs-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🛵 toRefs Api"><!---->🛵 toRefs Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏜️-toref-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🏜️ toRef Api"><!---->🏜️ toRef Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏙️-unref-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🏙️ unref Api"><!---->🏙️ unref Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-isref-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎉 isRef Api"><!---->🎉 isRef Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🪅-shallowref-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🪅 shallowRef Api"><!---->🪅 shallowRef Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🧸-triggerref-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🧸 triggerRef Api"><!---->🧸 triggerRef Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#其它-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="其它 Api"><!---->其它 Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎨-computed-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎨 computed Api"><!---->🎨 computed Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-watcheffect-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎉 watchEffect Api"><!---->🎉 watchEffect Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎡-watch-api" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎡 watch Api"><!---->🎡 watch Api<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-生命周期" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎉 生命周期"><!---->🎉 生命周期<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏀-vue3-依赖注入-provide-inject" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🏀 VUE3 依赖注入 provide inject"><!---->🏀 VUE3 依赖注入 provide inject<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎿-hook" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🎿 Hook"><!---->🎿 Hook<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🧸-h-函数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="🧸 h 函数"><!---->🧸 h 函数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#diff-算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="diff 算法"><!---->diff 算法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🪂组件</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><a href="/docs/exhibition.html" class="nav-link sidebar-link sidebar-page" aria-label="幻灯片"><!---->幻灯片<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Vue</h1><!----><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#读源码" class="router-link-active router-link-exact-active toc-link level2">读源码</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#options-api" class="router-link-active router-link-exact-active toc-link level3">options Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#methods-中的方法-this-指向" class="router-link-active router-link-exact-active toc-link level3">Methods 中的方法 this 指向</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#computed-简写-与-完整写法的处理" class="router-link-active router-link-exact-active toc-link level3">computed 简写 与 完整写法的处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#watch-监听器" class="router-link-active router-link-exact-active toc-link level3">watch 监听器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#依赖注入-provide-inject" class="router-link-active router-link-exact-active toc-link level3">依赖注入 provide inject</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#composition-api-1" class="router-link-active router-link-exact-active toc-link level3">composition Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🪂-setup" class="router-link-active router-link-exact-active toc-link level3">🪂 setup</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍟-reactive-响应式" class="router-link-active router-link-exact-active toc-link level3">🍟 reactive 响应式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍳-ref-响应式-官方-推荐尽量使用-ref-而不是-reactive" class="router-link-active router-link-exact-active toc-link level3">🍳 ref 响应式(官方：推荐尽量使用 ref 而不是 reactive)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🍃-readonly-只读" class="router-link-active router-link-exact-active toc-link level3">🍃 readonly 只读</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🚀-reactive-判断-api" class="router-link-active router-link-exact-active toc-link level3">🚀 Reactive 判断 Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🛵-torefs-api" class="router-link-active router-link-exact-active toc-link level3">🛵 toRefs Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏜️-toref-api" class="router-link-active router-link-exact-active toc-link level3">🏜️ toRef Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏙️-unref-api" class="router-link-active router-link-exact-active toc-link level3">🏙️ unref Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-isref-api" class="router-link-active router-link-exact-active toc-link level3">🎉 isRef Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🪅-shallowref-api" class="router-link-active router-link-exact-active toc-link level3">🪅 shallowRef Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🧸-triggerref-api" class="router-link-active router-link-exact-active toc-link level3">🧸 triggerRef Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#其它-api" class="router-link-active router-link-exact-active toc-link level3">其它 Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎨-computed-api" class="router-link-active router-link-exact-active toc-link level3">🎨 computed Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-watcheffect-api" class="router-link-active router-link-exact-active toc-link level3">🎉 watchEffect Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎡-watch-api" class="router-link-active router-link-exact-active toc-link level3">🎡 watch Api</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎉-生命周期" class="router-link-active router-link-exact-active toc-link level3">🎉 生命周期</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🏀-vue3-依赖注入-provide-inject" class="router-link-active router-link-exact-active toc-link level3">🏀 VUE3 依赖注入 provide inject</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🎿-hook" class="router-link-active router-link-exact-active toc-link level3">🎿 Hook</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#🧸-h-函数" class="router-link-active router-link-exact-active toc-link level3">🧸 h 函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/docs/vue-details%20%E6%BA%90%E7%A0%81.html#diff-算法" class="router-link-active router-link-exact-active toc-link level3">diff 算法</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="vue" tabindex="-1"><a class="header-anchor" href="#vue" aria-hidden="true">#</a> Vue</h1><blockquote><h4 id="什么是渐进式式框架" tabindex="-1"><a class="header-anchor" href="#什么是渐进式式框架" aria-hidden="true">#</a> <strong>什么是渐进式式框架</strong></h4><p><strong>表示可以在项目中一点点来引入和使用 Vue，而不一定需要全部引入使用 Vue，来开发整个项目</strong></p><p><code>&lt;template&gt;</code> 标签并不是 Vue 特有的，是 HTML 一个标签，但是它(包括它的内容)不会被浏览器渲染，而是用来被 js 脚本读取使用的</p></blockquote><blockquote><h4 id="composition-api" tabindex="-1"><a class="header-anchor" href="#composition-api" aria-hidden="true">#</a> Composition API</h4><p>🍟 Composition API 可以将相关联的代码放到同一处进行处理，而不需要在多个 Options 之间寻找</p><h4 id="hooks-函数增加代码的复用性" tabindex="-1"><a class="header-anchor" href="#hooks-函数增加代码的复用性" aria-hidden="true">#</a> Hooks 函数增加代码的复用性</h4><p>⛵ 在 Vue2.x 的时候，通常通过 mixins 在多个组件之间共享逻辑 但是有一个很大的缺陷就是 mixins 也是由一大堆的 Options 组成的，并且多个 mixinss 会<strong>存在命名冲突</strong>的问题 🚀 在 Vue3.x 中，可以通过 Hook 函数来将一部分独立的逻辑抽取出去，并且它们还<strong>可以做到是响应式的</strong>，通过按需导入，这样一目了然 Hook 函数来自哪个文件</p></blockquote><blockquote><p><strong><code>data 中返回的对象会被 Vue 的响应式系统劫持(响应式数据)</code></strong>，<strong>之后对该对象的修改或者访问都会在劫持中被处理</strong> 所以在 template 中通过  访问 data 中的数据，可从对象中获取到数据 所以修改 data 的值时，template 中的  的值也会发生改变</p></blockquote><blockquote><p><strong>在 vue2 中提供 .sync 修饰符，但是在 vue3 中不再支持.sync，取而代之的是 v-model</strong></p><p>在自定义组件中的 v-model，会默认展开成<code>:modelValue</code>和<code>@update:modelValue</code>的形式</p><div class="language-html ext-html line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-string-expression);">dialog</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">v-model</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;dialogVisible&quot;</span><span style="color:var(--shiki-color-text);">&gt;&lt;/</span><span style="color:var(--shiki-token-string-expression);">dialog</span><span style="color:var(--shiki-color-text);">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-html ext-html line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-string-expression);">dialog</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-function);">:modelValue</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;dialogVisible&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-function);">@update:modelValue</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;newValue =&gt; dialogVisible = newValue&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">&gt;&lt;/</span><span style="color:var(--shiki-token-string-expression);">dialog</span><span style="color:var(--shiki-color-text);">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在子组件中<code>emit(&#39;update:modelValue&#39;, newValue)</code>，父组件绑定的值就会随之修改。</p><p><strong>默认情况下，v-model 在组件上都是使用 <code>modelValue</code> 作为 prop，并以 <code>update:modelValue</code> 作为对应的事件。通过给 v-model 指定一个参数来更改这些名字：</strong></p><p><strong>v-model:自定义 prop = &#39;dialogVisible&#39;</strong></p></blockquote><h2 id="读源码" tabindex="-1"><a class="header-anchor" href="#读源码" aria-hidden="true">#</a> 读源码</h2><p><strong><code>登上 GitHub</code></strong> --- <strong><code>搜索代码仓库</code></strong> --- <strong><code>拉去代码分支(推荐 master 稳定分支)</code></strong> --- <strong><code>安装依赖查看 package.json 文件</code></strong> --- <strong><code>对项目进行打包或其它操作(如果打包或者其它操作后代码架构不清晰，可以尝试使用 --sourcemap，类似 webpack 的源码映射配置，有利于调试)</code></strong></p><p><strong>核心部分</strong></p><p><img src="/docs/img/image-20221103220601358.png" alt="image-20221103220601358" loading="lazy"></p><p><strong><code>D:\Material\Vue源码解析\core\packages\runtime-dom\src\index.ts</code></strong> <strong>从这开始 creatApp</strong></p><p><strong><code>D:\Material\Vue源码解析\core\packages\shared\src\index.ts</code></strong> <strong>Vue 在这里导出工具方法</strong></p><h3 id="options-api" tabindex="-1"><a class="header-anchor" href="#options-api" aria-hidden="true">#</a> options Api</h3><blockquote><h3 id="methods-中的方法-this-指向" tabindex="-1"><a class="header-anchor" href="#methods-中的方法-this-指向" aria-hidden="true">#</a> Methods 中的方法 this 指向</h3><p>不能使用 <strong>箭头函数</strong> 定义 methods 中的方法( this 指向问题，箭头函数没有 this，所以它在定义时候就确定 this 的值 )</p><p><strong>源码解读</strong>🍟</p><p><strong>在 Methods 中取出函数，通过 bind() 方法，显示的改变它的 this 指向 publicThis 并返回一个函数，将返回的函数赋值到上下文 ctx 对象以源函数同名的 key 属性 中，【实际上在代码中调用的并不是源函数，而是通过处理后的 <code>ctx[&#39;函数名&#39;]</code>】</strong></p><p><strong><code>publicThis</code></strong>：<strong>组件实例的代理 ，<code>const publicThis = instance.proxy</code></strong></p><p><code>D:\Material\Vue源码解析\core\packages\runtime-core\src\componentOptions.ts:625 </code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (methods) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">key</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> methods) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">methodHandler</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (methods </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">MethodOptions</span><span style="color:var(--shiki-color-text);">)[key]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(methodHandler)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-comment);">// 在开发模式下，我们使用`createRenderContext`函数来定义</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-comment);">// 代理目标的方法，那些是只读的但是</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-comment);">// 可重新配置，所以这里需要重新定义</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       </span><span style="color:var(--shiki-token-constant);">Object</span><span style="color:var(--shiki-token-function);">.defineProperty</span><span style="color:var(--shiki-color-text);">(ctx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> key</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         value</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">methodHandler</span><span style="color:var(--shiki-token-function);">.bind</span><span style="color:var(--shiki-color-text);">(publicThis)</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         configurable</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         enumerable</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         writable</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       ctx[key] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">methodHandler</span><span style="color:var(--shiki-token-function);">.bind</span><span style="color:var(--shiki-color-text);">(publicThis)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       </span><span style="color:var(--shiki-token-function);">checkDuplicateProperties</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">OptionTypes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">METHODS</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> key)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       </span><span style="color:var(--shiki-token-string-expression);">`Method &quot;</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-color-text);">key</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">&quot; has type &quot;</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-token-keyword);">typeof</span><span style="color:var(--shiki-color-text);"> methodHandler</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">&quot; in the component definition. `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         </span><span style="color:var(--shiki-token-string-expression);">`Did you reference the function correctly?`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="computed-简写-与-完整写法的处理" tabindex="-1"><a class="header-anchor" href="#computed-简写-与-完整写法的处理" aria-hidden="true">#</a> computed 简写 与 完整写法的处理</h3><p><code>D:\Material\Vue源码解析\core\packages\runtime-core\src\componentOptions.ts:694 </code></p><p><strong>🫕 同样不能使用箭头函数</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (computedOptions) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">key</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> computedOptions) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (computedOptions </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComputedOptions</span><span style="color:var(--shiki-color-text);">)[key]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 获取 getter 方法</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">get</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(opt) </span><span style="color:var(--shiki-token-comment);">// 判断是否为简写 Function 写法</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-token-function);">.bind</span><span style="color:var(--shiki-color-text);">(publicThis</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> publicThis) </span><span style="color:var(--shiki-token-comment);">// 修改 this 绑定 proxy(同Methods处理)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-color-text);">.get)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-token-function);">.</span><span style="color:var(--shiki-token-constant);">get</span><span style="color:var(--shiki-token-function);">.bind</span><span style="color:var(--shiki-color-text);">(publicThis</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> publicThis)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NOOP</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// NOOP = () =&gt; {}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> get </span><span style="color:var(--shiki-token-keyword);">===</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NOOP</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">`Computed property &quot;</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-color-text);">key</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">&quot; has no getter.`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 获取 setter 方法</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">set</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(opt) </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-color-text);">.set)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">opt</span><span style="color:var(--shiki-token-function);">.</span><span style="color:var(--shiki-token-constant);">set</span><span style="color:var(--shiki-token-function);">.bind</span><span style="color:var(--shiki-color-text);">(publicThis)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> __DEV__</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">                </span><span style="color:var(--shiki-token-string-expression);">`Write operation failed: computed property &quot;</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-color-text);">key</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">&quot; is readonly.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NOOP</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// ？？？compostion API</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">computed</span><span style="color:var(--shiki-color-text);">({</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        get</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        set</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-constant);">Object</span><span style="color:var(--shiki-token-function);">.defineProperty</span><span style="color:var(--shiki-color-text);">(ctx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> key</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        enumerable</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        configurable</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">get</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c</span><span style="color:var(--shiki-color-text);">.value</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// vue3 响应式写法</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">set</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> v </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">c</span><span style="color:var(--shiki-color-text);">.value </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> v)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 检查重复属性</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">checkDuplicateProperties</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">OptionTypes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">COMPUTED</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> key)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="watch-监听器" tabindex="-1"><a class="header-anchor" href="#watch-监听器" aria-hidden="true">#</a> watch 监听器</h3><p><strong><code>注意：watch 监听不到 引用类型 的旧值(oldValue)</code></strong></p><p><strong>其它写法(字符串)</strong>：<strong><code>监听属性:&#39;methods方法名&#39;</code></strong>;</p><p><strong>数组：</strong> <strong><code>[&#39;字符串写法&#39; , Function写法 , Object写法]，逐一被调用</code></strong></p><p><strong>对象属性简写：</strong> <strong><code>&#39;对象.属性&#39;(){}</code></strong></p></blockquote><blockquote><h3 id="依赖注入-provide-inject" tabindex="-1"><a class="header-anchor" href="#依赖注入-provide-inject" aria-hidden="true">#</a> 依赖注入 provide inject</h3><p><strong>如果需要返回 data 中的数据，需要使用 Function 写法，但是数据不会是响应式的，解决方案：</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">import</span><span style="color:var(--shiki-color-text);"> { computed } </span><span style="color:var(--shiki-token-keyword);">from</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;vue&#39;</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">provide</span><span style="color:var(--shiki-color-text);">(){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">this</span><span style="color:var(--shiki-color-text);">.name</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// 不是响应式</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 转化响应式数据</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-function);">computed</span><span style="color:var(--shiki-color-text);">(() </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">this</span><span style="color:var(--shiki-color-text);">.name)</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// Vue3 compostion API</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="composition-api-1" tabindex="-1"><a class="header-anchor" href="#composition-api-1" aria-hidden="true">#</a> composition Api</h3><blockquote><h3 id="🪂-setup" tabindex="-1"><a class="header-anchor" href="#🪂-setup" aria-hidden="true">#</a> 🪂 setup</h3><p><strong>在 setup 中应当避免使用 this，因为它不会找到组件实例。<code>setup 的调用发生在 data property、computed property 或 methods 被解折之前，调用 createComponentInstance 创建组件实例之后</code>，所以它们无法在 setup 中获取</strong></p><p><strong>在阅读源码的过程中，代码是按照如下顺序执行的</strong> &gt; <strong>🍟 调用 createComponentInstance 创建组件实例</strong> &gt; <strong>🍳 调用 setupComponent 初始化 component 内部的操作</strong> &gt; <strong>🍃 调用 setupStatefulComponent 初始化有状态的组件</strong> &gt; <strong>🌏 在 setupStatefulComponent 取出 setup 函数</strong> &gt; <strong>🛵 通过 callWithErrorHandling 的函数执行 setup</strong></p><p>处理组件在： <strong><code>D:\Material\Vue源码解析\core\packages\runtime-core\src\renderer.ts：421</code></strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// ...处理组件节点</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (shapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">COMPONENT</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">processComponent</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         n1</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">         optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">processComponent</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> n1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> n2</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> container</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererElement</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> anchor</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererNode</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">SuspenseBoundary</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> isSVG</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> slotScopeIds</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">string</span><span style="color:var(--shiki-color-text);">[] </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> optimized</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n2</span><span style="color:var(--shiki-color-text);">.slotScopeIds </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> slotScopeIds</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// n1 == null 表示这是挂载节点</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (n1 </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">n2</span><span style="color:var(--shiki-color-text);">.shapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">COMPONENT_KEPT_ALIVE</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     ;(parentComponent</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">.ctx </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">KeepAliveContext</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.activate</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-comment);">// 调用 mountComponent 挂载组件</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">mountComponent</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">       optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// n1 为非空表示这是一个更新，更新组件</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">updateComponent</span><span style="color:var(--shiki-color-text);">(n1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> n2</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> optimized)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 🍟 调用 createComponentInstance 创建组件实例</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mountComponent</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">MountComponentFn</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> initialVNode</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 2.x compat 可以在实际之前预先创建组件实例</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 安装,调用 createComponentInstance 创建组件实例</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">compatMountInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   __COMPAT__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">initialVNode</span><span style="color:var(--shiki-color-text);">.isCompatRoot </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">initialVNode</span><span style="color:var(--shiki-color-text);">.component</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   compatMountInstance </span><span style="color:var(--shiki-token-keyword);">||</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   (</span><span style="color:var(--shiki-token-constant);">initialVNode</span><span style="color:var(--shiki-color-text);">.component </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">createComponentInstance</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     initialVNode</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     parentSuspense</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   ))</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">type</span><span style="color:var(--shiki-color-text);">.__hmrId) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">registerHMR</span><span style="color:var(--shiki-color-text);">(instance)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">pushWarningContext</span><span style="color:var(--shiki-color-text);">(initialVNode)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">startMeasure</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">`mount`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// inject renderer internals for keepAlive</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isKeepAlive</span><span style="color:var(--shiki-color-text);">(initialVNode)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   ;(</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.ctx </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">KeepAliveContext</span><span style="color:var(--shiki-color-text);">).renderer </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> internals</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 解析设置上下文的道具和插槽</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 作用是对组件的 props 和 slots 等进行初始化处理(并且内部有对 Vue2.x 的 options Api 兼容处理)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">(__COMPAT__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> compatMountInstance)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">startMeasure</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">`init`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-comment);">// 🍳 调用 setupComponent 初始化 component 内部的操作</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">setupComponent</span><span style="color:var(--shiki-color-text);">(instance)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">endMeasure</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">`init`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// setup() is async. This component relies on async logic to be resolved</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// before proceeding</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__FEATURE_SUSPENSE__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.asyncDep) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   parentSuspense </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">parentSuspense</span><span style="color:var(--shiki-token-function);">.registerDep</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> setupRenderEffect)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-comment);">// Give it a placeholder if this is not hydration</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-comment);">// TODO handle self-defined fallback</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-constant);">initialVNode</span><span style="color:var(--shiki-color-text);">.el) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">placeholder</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.subTree </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">createVNode</span><span style="color:var(--shiki-color-text);">(Comment))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">     </span><span style="color:var(--shiki-token-function);">processCommentNode</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> placeholder</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> container</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> anchor)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">return</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">setupRenderEffect</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   instance</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   initialVNode</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> )</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">popWarningContext</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">endMeasure</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">`mount`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>D:\Material\Vue源码解析\core\packages\runtime-core\src\component.ts：596</code></strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// 🍳 调用 setupComponent 初始化 component 内部的操作</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">export</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">setupComponent</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">instance</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">isSSR </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">isInSSRComponentSetup </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> isSSR</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> { </span><span style="color:var(--shiki-token-constant);">props</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">children</span><span style="color:var(--shiki-color-text);"> } </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.vnode</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 判断是否是有状态组件</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">isStateful</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isStatefulComponent</span><span style="color:var(--shiki-color-text);">(instance)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 初始化 props 和 slots</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">initProps</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> props</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isStateful</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isSSR)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">initSlots</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> children)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 🍃 调用 setupStatefulComponent 初始化有状态的组件</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">/**</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">   * 设置有状态</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">   * </span><span style="color:var(--shiki-token-keyword);">@param</span><span style="color:var(--shiki-token-comment);"> </span><span style="color:var(--shiki-token-function);">{object}</span><span style="color:var(--shiki-token-comment);"> 【对象】组件 - 有状态组件</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">   * </span><span style="color:var(--shiki-token-keyword);">@param</span><span style="color:var(--shiki-token-comment);"> </span><span style="color:var(--shiki-token-function);">{fuction}</span><span style="color:var(--shiki-token-comment);"> 【函数】组件 - 无状态组件</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">  */</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">setupResult</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> isStateful</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">setupStatefulComponent</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isSSR) </span><span style="color:var(--shiki-token-comment);">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">undefined</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  isInSSRComponentSetup </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> setupResult</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 🌏 在setupStatefulComponent 取出 setup 函数</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">setupStatefulComponent</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  instance</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  isSSR</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.type </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentOptions</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.name) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">validateComponentName</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.name</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">appContext</span><span style="color:var(--shiki-color-text);">.config)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.components) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">names</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Object</span><span style="color:var(--shiki-token-function);">.keys</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.components)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">; i </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">names</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);">; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">validateComponentName</span><span style="color:var(--shiki-color-text);">(names[i]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">appContext</span><span style="color:var(--shiki-color-text);">.config)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.directives) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">names</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Object</span><span style="color:var(--shiki-token-function);">.keys</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.directives)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">; i </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">names</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);">; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">validateDirectiveName</span><span style="color:var(--shiki-color-text);">(names[i])</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.compilerOptions </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isRuntimeOnly</span><span style="color:var(--shiki-color-text);">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`&quot;compilerOptions&quot; is only supported when using a build of Vue that `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-string-expression);">`includes the runtime compiler. Since you are using a runtime-only `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-string-expression);">`build, the options should be passed via your build tool config instead.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 0. 创建渲染代理属性访问缓存</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.accessCache </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Object</span><span style="color:var(--shiki-token-function);">.create</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 1. 创建公共实例/渲染代理</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 也将其标记为原始的，因此从未观察​​到</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.proxy </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">markRaw</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">new</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Proxy</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.ctx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> PublicInstanceProxyHandlers))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">exposePropsOnRenderContext</span><span style="color:var(--shiki-color-text);">(instance)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 2. call setup() 调用 setup()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> { </span><span style="color:var(--shiki-token-constant);">setup</span><span style="color:var(--shiki-color-text);"> } </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> Component</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (setup) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// sutup 有参数 创建 setup 上下文, 并且将 setup 上下文挂载到实例上 setupContext = { attrs, slots, emit }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">setupContext</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.setupContext </span><span style="color:var(--shiki-token-keyword);">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-constant);">setup</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">createSetupContext</span><span style="color:var(--shiki-color-text);">(instance) </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">setCurrentInstance</span><span style="color:var(--shiki-color-text);">(instance)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">pauseTracking</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 🛵 通过 callWithErrorHandling 的函数执行 setup</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 执行 setup 函数并且将返回值赋值给 setupResult(获取结果)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 内部会执行 setup 函数并且将instance(prop)、setupContext 作为参数传入</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 为什么不直接执行,通过callWithErrorHandling封装一些捕获错误的方法 try...catch</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">setupResult</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">callWithErrorHandling</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      setup</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      instance</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-constant);">ErrorCodes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">SETUP_FUNCTION</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      [__DEV__ </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">shallowReadonly</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.props) </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.props</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> setupContext] </span><span style="color:var(--shiki-token-comment);">// 传递 prop setupContext,回调setup(...args)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">resetTracking</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">unsetCurrentInstance</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isPromise</span><span style="color:var(--shiki-color-text);">(setupResult)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-constant);">setupResult</span><span style="color:var(--shiki-token-function);">.then</span><span style="color:var(--shiki-color-text);">(unsetCurrentInstance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> unsetCurrentInstance)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (isSSR) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// return the promise so server-renderer can wait on it</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> setupResult</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">.then</span><span style="color:var(--shiki-color-text);">((resolvedResult</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">unknown</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-function);">handleSetupResult</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> resolvedResult</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isSSR)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">.catch</span><span style="color:var(--shiki-color-text);">(e </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-function);">handleError</span><span style="color:var(--shiki-color-text);">(e</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ErrorCodes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">SETUP_FUNCTION</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__FEATURE_SUSPENSE__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// async setup returned Promise.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// bail here and wait for re-entry.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.asyncDep </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> setupResult</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.suspense) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Component</span><span style="color:var(--shiki-color-text);">.name </span><span style="color:var(--shiki-token-keyword);">??</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;Anonymous&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-string-expression);">`Component &lt;</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-color-text);">name</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">&gt;: setup function returned a promise, but no `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-string-expression);">`&lt;Suspense&gt; boundary was found in the parent component tree. `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-string-expression);">`A component with async setup() must be nested in a &lt;Suspense&gt; `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-string-expression);">`in order to be rendered.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-string-expression);">`setup() returned a Promise, but the version of Vue you are using `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-string-expression);">`does not support it yet.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">handleSetupResult</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> setupResult</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isSSR)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">finishComponentSetup</span><span style="color:var(--shiki-color-text);">(instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> isSSR)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// callWithErrorHandling 函数帮助执行 steup 函数，捕获错误</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">export</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">callWithErrorHandling</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">fn</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Function</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  instance</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  type</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ErrorTypes</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  args</span><span style="color:var(--shiki-token-keyword);">?:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">unknown</span><span style="color:var(--shiki-color-text);">[]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> res</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">try</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 为什么不能在 setup 使用 this？这里没有对函数 setup 进行 this 绑定</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    res </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> args </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fn</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">...</span><span style="color:var(--shiki-color-text);">args) </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fn</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">catch</span><span style="color:var(--shiki-color-text);"> (err) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">handleError</span><span style="color:var(--shiki-color-text);">(err</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> type)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> res</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h4 id="小习惯" tabindex="-1"><a class="header-anchor" href="#小习惯" aria-hidden="true">#</a> 小习惯：</h4><p>当调用函数时，仅仅需要获取函数的第二个参数的使用，不需要第一个参数时，通常使用 <code>_</code>进行占位</p><p><code>setup ( _ , context )</code></p></blockquote><blockquote><h3 id="🍟-reactive-响应式" tabindex="-1"><a class="header-anchor" href="#🍟-reactive-响应式" aria-hidden="true">#</a> 🍟 reactive 响应式</h3><p><strong>reactive 当传入基础数据类型会产生控制台警告，正确应当使用 对象或者数组</strong></p><p><strong>options Api 的响应式处理也时通过 composition Api 进行包裹处理的</strong>，<strong><code>reactive({ ...包裹 options Api 响应式数据 })</code></strong></p><p><strong><code>通过使用 reactive 处理后的返回值，当读取时，会做一个数据劫持(Proxy 做数据劫持[getter、setter])</code></strong></p><p><strong><code>响应式数据被使用的时候，会进行依赖的收集(模板上的数据使用...等等)，当数据发生改变的时候，对相应收集的依赖进行对应的响应式更新操作</code></strong></p></blockquote><blockquote><h3 id="🍳-ref-响应式-官方-推荐尽量使用-ref-而不是-reactive" tabindex="-1"><a class="header-anchor" href="#🍳-ref-响应式-官方-推荐尽量使用-ref-而不是-reactive" aria-hidden="true">#</a> 🍳 ref 响应式(官方：推荐尽量使用 ref 而不是 reactive)</h3><p><strong>ref 会返回一个<code>可变的响应式对象</code>，该对象<code>作为一个【响式的引用】维护着它【内部的值】</code>，这就是 ref 名称的来源；</strong> &gt; <strong>它内部的值是在 ref 的 value 属性中被维护的，真正的数据是在 value 中维护；</strong></p><p><strong>在<code>模板</code>中使用 ref 数据，理论来说应当是一个 可变的 ref 响应式对象，Vue 为了开发方便，在模板使用 ref 对象时，会自动进行解包，不需要 <code>ref.value</code></strong>；</p><p><strong>注意：在逻辑代码中并没有自动进行解包，可以使用 Vue 的新实验性功能对逻辑代码进行解包 -&gt; <a href="https://github.com/vuejs/core/tree/main/packages/reactivity-transform" target="_blank" rel="noopener noreferrer">Vue 的响应性语法糖<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><h4 id="ref-解包" tabindex="-1"><a class="header-anchor" href="#ref-解包" aria-hidden="true">#</a> ref 解包：</h4><p><strong>ref 的解包操作是一个<code>浅层的解包</code>，当在模板中直接读取 ref 对象时才会进行解包操作，但是<code>通过将 ref 对象直接赋值给一个普通对象属性时，在模板中通过 对象.ref 对象 时是不会进行解包的</code></strong>，简单来说就是通过包裹的 ref 对象后在模板中不能进行解包了</p><p><strong>不能解包情况【普通对象包裹】，能解包情况【reactive 对象包裹】</strong></p></blockquote><blockquote><h3 id="🍃-readonly-只读" tabindex="-1"><a class="header-anchor" href="#🍃-readonly-只读" aria-hidden="true">#</a> 🍃 readonly 只读</h3><p><strong>readonly 会<code>返回原生对象的只读代理</code>（也就是它依然是一个 Proxy ，这个 Proxy 的 <code>set 方法被劫持</code>，并且不能对其进行修改)【在 setter 方法里对数据修改进行限制】</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// 源对象(普通对象)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">info</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">};</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 处理后返回的对象</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">info_</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">readonly</span><span style="color:var(--shiki-color-text);">(info);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 注意：源对象可以被修改，修改源对象数据不会更新🍃</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">reactive;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">info_</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">readonly</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	info </span><span style="color:var(--shiki-token-comment);">/* reactive 处理后的对象在进行 readonly，不可以被修改 */</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 注意：reactive 源对象可以被修改，被修改，readonly 对象数据会更新(因为是响应式的)🍃</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">ref;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">info_</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">readonly</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	info </span><span style="color:var(--shiki-token-comment);">/* ref 处理后的对象在进行 readonly，不可以被修改 */</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 注意：ref 源对象可以被修改，被修改，readonly 对象数据会更新(因为是响应式的)🍃</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🚀-reactive-判断-api" tabindex="-1"><a class="header-anchor" href="#🚀-reactive-判断-api" aria-hidden="true">#</a> 🚀 Reactive 判断 Api</h3><p><strong><code>isProxy</code>：检查对象是否由 reactive 或者 readonly 创建的 Proxy 代理</strong></p><p><strong><code>isReactive</code>：检查对象是否由 reactive 创建的响应式代理【注意：如果该代理是由 readonly 创建的，但是包裹的是 reactive 创建的另外一个代理，同样返回 true】</strong></p><p><strong><code>isReadonly </code>：检查对象是否由 readonly 创建的 Proxy 只读代理</strong></p><p><strong><code>toRaw</code>：返回 reactive or readonly 代理的原始对象</strong></p><p><strong><code>shallowReactive</code>：创建浅层次的 Proxy 代理【只对第一层 property 属性进行代理，不执行深层次的嵌套对象代理，深层次的对象还是原始的对象】</strong></p><p><strong><code>shallowReadonly</code>：作用同上</strong></p></blockquote><blockquote><h3 id="🛵-torefs-api" tabindex="-1"><a class="header-anchor" href="#🛵-torefs-api" aria-hidden="true">#</a> 🛵 toRefs Api</h3><p><strong>对 reactive <code>所有属性进行转化 ref 对象</code>，参数必须是响应式对象</strong></p><p><strong>通过 refs 解构返回 name ref 对象，<code>在 reactive 的属性与 ref.value 属性建立链接🪂</code>，任何一方修改，都会引起另外一方变化</strong></p><p><strong>对 reactive 进行对象解构为什么会丢失响应式？</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> { </span><span style="color:var(--shiki-token-constant);">name</span><span style="color:var(--shiki-color-text);"> } </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">reactive</span><span style="color:var(--shiki-color-text);">({ name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);"> });</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 相当于</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> name </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);">; </span><span style="color:var(--shiki-token-comment);">// 直接赋值数据(基础数据🛰️)，丢失响应式</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🏜️-toref-api" tabindex="-1"><a class="header-anchor" href="#🏜️-toref-api" aria-hidden="true">#</a> 🏜️ toRef Api</h3><p><strong>对一个属性进行 ref 对象转化，<code>区别于 toRefs 减少性能开销，没有解构赋值，因为只返回一个值</code>，参数必须是响应式对象</strong></p></blockquote><blockquote><h3 id="🏙️-unref-api" tabindex="-1"><a class="header-anchor" href="#🏙️-unref-api" aria-hidden="true">#</a> 🏙️ unref Api</h3><p><strong>获取一个 ref 对象引用中的 value 值【解包】，一个语法糖</strong></p><p><strong><code>val = isRef(val)? val.value : value</code></strong></p></blockquote><blockquote><h3 id="🎉-isref-api" tabindex="-1"><a class="header-anchor" href="#🎉-isref-api" aria-hidden="true">#</a> 🎉 isRef Api</h3><p><strong>同上 isReactive</strong></p></blockquote><blockquote><h3 id="🪅-shallowref-api" tabindex="-1"><a class="header-anchor" href="#🪅-shallowref-api" aria-hidden="true">#</a> 🪅 shallowRef Api</h3><p><strong>浅层的 ref 对象</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ref</span><span style="color:var(--shiki-color-text);">({ name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);"> });</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 修改 val，深层次的修改(直接通过 .name 修改)，还是响应式</span></span>
<span class="line"><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">value</span><span style="color:var(--shiki-color-text);">.name </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE3&#39;</span><span style="color:var(--shiki-color-text);">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 浅层</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">shallowRef</span><span style="color:var(--shiki-color-text);">({ name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);"> });</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 修改 val，深层次的修改(直接通过 .name 修改)，shallowRef 后不是响应式</span></span>
<span class="line"><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">value</span><span style="color:var(--shiki-color-text);">.name </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE3&#39;</span><span style="color:var(--shiki-color-text);">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 只对 val.value 的修改产生响应式</span></span>
<span class="line"><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.value </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> { name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE3&#39;</span><span style="color:var(--shiki-color-text);"> };</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🧸-triggerref-api" tabindex="-1"><a class="header-anchor" href="#🧸-triggerref-api" aria-hidden="true">#</a> 🧸 triggerRef Api</h3><p><strong>解决 shallowRef 对于深层次的修改后，不会更新对应的属性【不是响应式】</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ref</span><span style="color:var(--shiki-color-text);">({ name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);"> });</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 修改 val，深层次的修改(直接通过 .name 修改)，还是响应式</span></span>
<span class="line"><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">value</span><span style="color:var(--shiki-color-text);">.name </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE3&#39;</span><span style="color:var(--shiki-color-text);">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 浅层</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">shallowRef</span><span style="color:var(--shiki-color-text);">({ name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE&#39;</span><span style="color:var(--shiki-color-text);"> });</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 修改 val，深层次的修改(直接通过 .name 修改)，shallowRef 后不是响应式</span></span>
<span class="line"><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">value</span><span style="color:var(--shiki-color-text);">.name </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;VUE3&#39;</span><span style="color:var(--shiki-color-text);">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 调用 triggerRef 触发响应式更新(手动触发更新)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">triggerRef</span><span style="color:var(--shiki-color-text);">(val);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="其它-api" tabindex="-1"><a class="header-anchor" href="#其它-api" aria-hidden="true">#</a> 其它 Api</h3><h4 id="🎿-customref-创建自定义-ref" tabindex="-1"><a class="header-anchor" href="#🎿-customref-创建自定义-ref" aria-hidden="true">#</a> 🎿 customRef 创建自定义 ref</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ref</span><span style="color:var(--shiki-color-text);">(value){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 接受两个参数 track(收集依赖触发更新)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-function);">customRef</span><span style="color:var(--shiki-color-text);">((track</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">trigger)</span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		</span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">			</span><span style="color:var(--shiki-token-function);">get</span><span style="color:var(--shiki-color-text);">(){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">				</span><span style="color:var(--shiki-token-function);">track</span><span style="color:var(--shiki-color-text);">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">				retrun value</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">			}</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">			</span><span style="color:var(--shiki-token-function);">set</span><span style="color:var(--shiki-color-text);">(newValue){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">				value</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">newValue;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">				</span><span style="color:var(--shiki-token-function);">track</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">			}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	})</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🎨-computed-api" tabindex="-1"><a class="header-anchor" href="#🎨-computed-api" aria-hidden="true">#</a> 🎨 computed Api</h3><p><strong>computed 返回一个 ref 对象</strong></p></blockquote><blockquote><h3 id="🎉-watcheffect-api" tabindex="-1"><a class="header-anchor" href="#🎉-watcheffect-api" aria-hidden="true">#</a> 🎉 watchEffect Api</h3><p><strong><code>watchEffect</code>：自动收集响应式数据的依赖，默认开启自动执行一次</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ref</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;0&#39;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">watchEffect</span><span style="color:var(--shiki-color-text);">(()</span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-constant);">console</span><span style="color:var(--shiki-token-function);">.log</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;执行&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-constant);">val</span><span style="color:var(--shiki-color-text);">.value)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">/* 接受第三个参数 option */</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 需要使用到获取 dom 数据时候 ‘post’，总之都会默认执行一次，进行依赖收集</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    flush</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-string-expression);">&#39;pre&#39;</span><span style="color:var(--shiki-color-text);">(默认值，默认一开始执行一次)</span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-token-string-expression);">&#39;post&#39;</span><span style="color:var(--shiki-color-text);">(dom 挂载or更新完执行一次)</span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-token-string-expression);">&#39;sync&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">})</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>默认自动执行一次，<code>并在执行后收集响应式依赖</code>，当依赖发生变化时，重新执行</strong></p><p><strong><code>停止 watchEffect 监听</code>，watchEffect 会返回一个函数，当执行返回的函数时，就会停止 watchEffect 的监听</strong></p><p><strong>清除副作用</strong></p><p>在开发中需要在监听函数中执行网络请求，但是在网络请求还没有达到的时候，或者监听器监听函数被再次执行。那么上一次的网络请求应该被取消掉，这个时候就可以清除上一次的副作用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// watchEffect 接受一个参数回调函数，fn 里面再传入一个回调函数用于取消操作</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">watchEffect</span><span style="color:var(--shiki-color-text);">((fn) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-comment);">// 当副作用即将重新执行或者监听器被停止时会执行该函数传入的回调函数</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-function);">fn</span><span style="color:var(--shiki-color-text);">(() </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		</span><span style="color:var(--shiki-token-comment);">// ...取消操作</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	});</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="🎡-watch-api" tabindex="-1"><a class="header-anchor" href="#🎡-watch-api" aria-hidden="true">#</a> 🎡 watch Api</h3><p><strong><code>watch</code>：手动指定监听的数据源</strong></p><p><strong>基本同 options Api</strong></p><p><strong>接受接受四种类型的目标源：getter 函数并返回一个响应式数据、ref 对象</strong>、...</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">注意：vue 对 reactive 类型的传参时，newValue 与 oldValue 是一个 Porxy 对象，ref 其它类型为原生的数据🏀🏀🏀</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 解决 reactive 类型的传参时，newValue 与 oldValue 是一个 Porxy 对象</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">watch</span><span style="color:var(--shiki-color-text);">(()</span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">...</span><span style="color:var(--shiki-color-text);">reactive</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">(newValue</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">oldValue)</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">})</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// 执行,对参数进行校验</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">export</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">watch</span><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-function);">T</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">any</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Immediate</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">extends</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Readonly</span><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-constant);">boolean</span><span style="color:var(--shiki-color-text);">&gt; </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span><span style="color:var(--shiki-color-text);">&gt;(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  source</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">T</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchSource</span><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-function);">T</span><span style="color:var(--shiki-color-text);">&gt;</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  cb</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">any</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  options</span><span style="color:var(--shiki-token-keyword);">?:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchOptions</span><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-function);">Immediate</span><span style="color:var(--shiki-color-text);">&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchStopHandle</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(cb)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-string-expression);">`\`watch(fn, options?)\` signature has been moved to a separate API. `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`Use \`watchEffect(fn, options?)\` instead. \`watch\` now only `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`supports \`watch(source, cb, options?) signature.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// ...执行</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">doWatch</span><span style="color:var(--shiki-color-text);">(source </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">any</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> cb</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> options)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">doWatch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  source</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchSource</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchSource</span><span style="color:var(--shiki-color-text);">[] </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchEffect</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">object</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  cb</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchCallback</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  { immediate</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> deep</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> flush</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> onTrack</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> onTrigger }</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchOptions</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">EMPTY_OBJ</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">WatchStopHandle</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">cb) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (immediate </span><span style="color:var(--shiki-token-keyword);">!==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">undefined</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`watch() &quot;immediate&quot; option is only respected when using the `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-string-expression);">`watch(source, callback, options?) signature.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (deep </span><span style="color:var(--shiki-token-keyword);">!==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">undefined</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`watch() &quot;deep&quot; option is only respected when using the `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-string-expression);">`watch(source, callback, options?) signature.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">warnInvalidSource</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (s</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">unknown</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-string-expression);">`Invalid watch source: `</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      s</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-string-expression);">`A watch source can only be a getter/effect function, a ref, `</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-string-expression);">`a reactive object, or an array of these types.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> currentInstance</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 监听的数据源会赋值 getter 函数</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">any</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> forceTrigger </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> isMultiSource </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 接受四种类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-comment);">// 判断是否ref对象</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isRef</span><span style="color:var(--shiki-color-text);">(source)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">source</span><span style="color:var(--shiki-color-text);">.value</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    forceTrigger </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isShallow</span><span style="color:var(--shiki-color-text);">(source)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isReactive</span><span style="color:var(--shiki-color-text);">(source)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> source</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 判断reactive默认开启deep</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    deep </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isArray</span><span style="color:var(--shiki-color-text);">(source)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 判断开启多目标源监听</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    isMultiSource </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    forceTrigger </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">source</span><span style="color:var(--shiki-token-function);">.some</span><span style="color:var(--shiki-color-text);">(s </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isReactive</span><span style="color:var(--shiki-color-text);">(s) </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">isShallow</span><span style="color:var(--shiki-color-text);">(s))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-constant);">source</span><span style="color:var(--shiki-token-function);">.map</span><span style="color:var(--shiki-color-text);">(s </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isRef</span><span style="color:var(--shiki-color-text);">(s)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">s</span><span style="color:var(--shiki-color-text);">.value</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isReactive</span><span style="color:var(--shiki-color-text);">(s)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">traverse</span><span style="color:var(--shiki-color-text);">(s)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(s)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">callWithErrorHandling</span><span style="color:var(--shiki-color-text);">(s</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ErrorCodes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">WATCH_GETTER</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          __DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">warnInvalidSource</span><span style="color:var(--shiki-color-text);">(s)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isFunction</span><span style="color:var(--shiki-color-text);">(source)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (cb) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// getter with cb</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">callWithErrorHandling</span><span style="color:var(--shiki-color-text);">(source</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> instance</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ErrorCodes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">WATCH_GETTER</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// no cb -&gt; simple effect</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">getter</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> () </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (instance </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">instance</span><span style="color:var(--shiki-color-text);">.isUnmounted) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">return</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (cleanup) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">cleanup</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">callWithAsyncErrorHandling</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          source</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          instance</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-constant);">ErrorCodes</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">WATCH_CALLBACK</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          [onCleanup]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    getter </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NOOP</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    __DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">warnInvalidSource</span><span style="color:var(--shiki-color-text);">(source)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🎉-生命周期" tabindex="-1"><a class="header-anchor" href="#🎉-生命周期" aria-hidden="true">#</a> 🎉 生命周期</h3><p><strong>composition Api 生命周期函数为<code>一个回调函数，可以注册多个生命周期(可以进行代码解耦，封装 hook)</code></strong></p><p>注意：<code>Vue3 中没有 beforeCreate、create，</code><strong><code>setup 函数代替了它们，并且比它们还要早执行</code></strong></p><p><strong>options Api 中，beforeCreate、create 的实现与其它的钩子函数实现原理不一样</strong></p></blockquote><blockquote><h3 id="🏀-vue3-依赖注入-provide-inject" tabindex="-1"><a class="header-anchor" href="#🏀-vue3-依赖注入-provide-inject" aria-hidden="true">#</a> 🏀 VUE3 依赖注入 provide inject</h3><p><strong>使用方法基本同 options Api，不同的是响应式数据的处理，options Api 响应式数据需要导入 computed 方法对数据进行响应式转化，composition Api 通过 ref 或者 reactive 声明即可</strong></p><p><strong>注意：尽量不要在子组件 inject 获取数据去修改父组件传过来的数据，传递应当进行 readonly 只读处理【遵循单向数据流】</strong></p></blockquote><blockquote><h3 id="🎿-hook" tabindex="-1"><a class="header-anchor" href="#🎿-hook" aria-hidden="true">#</a> 🎿 Hook</h3><p><strong>规范以 <code>use</code> 前缀开始命名</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">export</span><span style="color:var(--shiki-color-text);"> useXXX = function(){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	const xxx = ref(&#39;xxx&#39;)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	const yyy = ()=&gt;{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		xxx.value = &#39;yyy&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 返回功能属性方法...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		xxx</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">		yyy</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 使用</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> { </span><span style="color:var(--shiki-token-constant);">xxx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-constant);">yyy</span><span style="color:var(--shiki-color-text);"> } </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">useXXX</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// 同样可以使用扩展运算符 ...(缺点：不清楚数据来源)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">...</span><span style="color:var(--shiki-color-text);">useXXX</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><blockquote><h3 id="🧸-h-函数" tabindex="-1"><a class="header-anchor" href="#🧸-h-函数" aria-hidden="true">#</a> 🧸 h 函数</h3><p><strong>Vue 推荐在绝大数情况下使用模板来创建你的 HTML，对于一些特殊的场景，真的需要 JavaScript 的完全编程的能力，这个时候可以使用渲染函数，<code>它比模板更接近编译器🎉</code></strong></p><p><strong>Vue 在生成真实的 DOM 之前，会<code>将节点转换成 VNode 虚拟节点</code>，而 <code>VNode 虚拟节点组合在一起形成一颗树结构</code>，这棵树就是虚拟 DOM【VDOM】</strong></p><p><strong>事实上，<code>通过编写 template HTML 方式最终也是通过使用 渲染函数 生成对应的 VNode 虚拟节点</code></strong></p><p><strong><code>template 经过 compile 编译转化 render 调用函数返回 VNode</code></strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">// Vue2 h 函数作为 render 的参数去接受</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// Vue3 h 函数需要通过 import 导入</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">render</span><span style="color:var(--shiki-color-text);">(h){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-comment);">// retrun VNode</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 接受三个参数</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 1、标签：string | object | function 标签名、组件、异步组件(引入组件时不需要注册组件直接使用)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 2、props 属性事件...，没有时候没有不传，第三个参数作为第二参数，但是建议使用 null 占位</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 3、子元素：string | array | object | 插槽slot</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">h</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;div&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">{</span><span style="color:var(--shiki-token-comment);">/* 属性 */</span><span style="color:var(--shiki-color-text);">}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">[</span><span style="color:var(--shiki-token-comment);">/* 子元素 */</span><span style="color:var(--shiki-color-text);">]</span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);">标签内容)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 这里为什么可以使用 this 访问响应式属性？因为 render 函数是有给绑定 this 的</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">h</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;div&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-string-expression);">`</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-token-constant);">this</span><span style="color:var(--shiki-color-text);">.xxx</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// Vue3 h 函数写法</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setup</span><span style="color:var(--shiki-color-text);">(){</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">xxx</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ref</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;yyy&#39;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">retrun</span><span style="color:var(--shiki-color-text);"> ()</span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">h</span><span style="color:var(--shiki-color-text);">(xxx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">xxx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-string-expression);">`</span><span style="color:var(--shiki-token-keyword);">${</span><span style="color:var(--shiki-token-constant);">xxx</span><span style="color:var(--shiki-color-text);">.value</span><span style="color:var(--shiki-token-keyword);">}</span><span style="color:var(--shiki-token-string-expression);">`</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">h</span><span style="color:var(--shiki-color-text);">(组件</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">xxx</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            default</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-function);">函数</span><span style="color:var(--shiki-color-text);">(props)</span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-token-function);">h</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-comment);">// 父组件定义</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-constant);">this</span><span style="color:var(--shiki-token-function);">.</span><span style="color:var(--shiki-token-constant);">$slot</span><span style="color:var(--shiki-token-function);">.default</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-keyword);">??</span><span style="color:var(--shiki-token-string-expression);">&#39;&#39;</span><span style="color:var(--shiki-token-comment);">// 子组件使用</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        })</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">// jsx 写法，脚手架不支持需要使用 Babel 转化</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">jsx </span><span style="color:var(--shiki-token-keyword);">-&gt;</span><span style="color:var(--shiki-color-text);"> 转化 </span><span style="color:var(--shiki-token-keyword);">-&gt;</span><span style="color:var(--shiki-color-text);"> h 函数 </span><span style="color:var(--shiki-token-keyword);">-&gt;</span><span style="color:var(--shiki-color-text);"> VNode </span><span style="color:var(--shiki-token-keyword);">-&gt;</span><span style="color:var(--shiki-color-text);"> VDom</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="diff-算法" tabindex="-1"><a class="header-anchor" href="#diff-算法" aria-hidden="true">#</a> diff 算法</h3><blockquote><h4 id="🎨-key-的作用" tabindex="-1"><a class="header-anchor" href="#🎨-key-的作用" aria-hidden="true">#</a> 🎨 key 的作用</h4><p><strong>key 属性主要用于 Vue 的虚拟 DOM 算法，<code>在新旧节点 nodes 对比时，辨识 VNode</code></strong></p><p><strong>不使用 Key：如果不使用 key，<code>Vue 会使用一种最大限度减少动态元素并且尽可能尝试地修改 or 修复相同类型的元素的算法</code></strong></p><p><strong>使用 Key：Vue 会基于 Key 的变化<code>(根据 Key)，重新排序元素的顺序，并且移除销毁不存在的 Key 元素</code></strong></p><h5 id="🌏-vnode-虚拟节点" tabindex="-1"><a class="header-anchor" href="#🌏-vnode-虚拟节点" aria-hidden="true">#</a> 🌏 VNode 虚拟节点</h5><p>浅层次理解：<strong>真实节点 HTML【<code>h1、div、span</code>】，虚拟节点 VNode <code>Javascript 对象</code>【存在内存当中】</strong></p><p><strong>事实上，<code>无论是组件还是元素，在 Vue 中表现出来的都是一个个 VNode</code>，Vue 会将模板中的一个个组件或者元素转换成 VNode 对象【参考 h 函数】</strong></p><p><strong>VNode：本质 Javascript 对象，用于描述组件或者标签，为什么要多此一举通过 VNode 再转换 VDom 再真实 Dom？可以多平台适配【服务端渲染、移动端渲染、跨平台渲染】</strong></p><h5 id="🛵-vdom-虚拟-dom" tabindex="-1"><a class="header-anchor" href="#🛵-vdom-虚拟-dom" aria-hidden="true">#</a> 🛵 VDom 虚拟 DOM</h5><p><strong><code>通过一个个 VNode 对象关系整合，形成的一颗对象树，称之为 虚拟 DOM</code></strong></p><p><strong>通过虚拟 DOM 渲染成为真实的 DOM，在浏览器展示，需要知道的是，VDOM 与真实的 DOM 并不是一一对应的，虚拟 DOM 存在一些 Vue 组件( VNode )</strong></p><h5 id="举个-🌰" tabindex="-1"><a class="header-anchor" href="#举个-🌰" aria-hidden="true">#</a> 举个 🌰</h5><p><strong>当在一个数组中任意位置添加一个元素，如何才能高效更新 DOM?</strong></p><p>1、全部干掉，重新更新数组里面所有元素【最不高效】</p><p>2、因为在插入的元素中，数组前面的元素位置不变，后面元素的位置才会改变，前面元素不变，更新后面的元素【还不错】【<code>无 Key做法</code>】</p><p><strong>3、直接在数组中插入需要插入的元素【最高效】，怎么插？ 🍃 通过 新旧 VDom(VNodes) 对比根据需要变化地方进行更新，【怎么对比？这就是 diff 算法做的事情，Key 的作用】【<code>有 Key</code>】</strong></p><p>在源码中，如果存在 Key，则调用的是 pathKeyedChildren，不存在 Key，调用 pathUnKeyedChildren</p><p><code>D:\Material\Vue源码解析\core\packages\runtime-core\src\renderer.ts：1593</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">patchChildren</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">PatchChildrenFn</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    n1</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    optimized </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  ) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> n1 </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n1</span><span style="color:var(--shiki-color-text);">.children</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">prevShapeFlag</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> n1 </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n1</span><span style="color:var(--shiki-color-text);">.shapeFlag </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n2</span><span style="color:var(--shiki-color-text);">.children</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> { </span><span style="color:var(--shiki-token-constant);">patchFlag</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">shapeFlag</span><span style="color:var(--shiki-color-text);"> } </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> n2</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// fast path</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (patchFlag </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 判断 key 是否存在</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (patchFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">PatchFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">KEYED_FRAGMENT</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// this could be either fully-keyed or mixed (some keyed some not)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">//patchFlag 的存在意味着子元素被保证是数组</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">patchKeyedChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          c1 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// 旧的 VNodes</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          c2 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// 新的 VNodes</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (patchFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">PatchFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">UNKEYED_FRAGMENT</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// unkeyed 无键</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">patchUnkeyedChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          c1 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          c2 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">return</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">//children 有 3 种可能性：文本、数组或无子项</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (shapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">TEXT_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// text children fast path</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (prevShapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">ARRAY_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">unmountChildren</span><span style="color:var(--shiki-color-text);">(c1 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentSuspense)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (c2 </span><span style="color:var(--shiki-token-keyword);">!==</span><span style="color:var(--shiki-color-text);"> c1) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">hostSetElementText</span><span style="color:var(--shiki-color-text);">(container</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> c2 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">string</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (prevShapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">ARRAY_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// prev children was array</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (shapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">ARRAY_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// two arrays, cannot assume anything, do full diff</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">patchKeyedChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            c1 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            c2 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// no new children, just unmount old</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">unmountChildren</span><span style="color:var(--shiki-color-text);">(c1 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// prev children was text OR null</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// new children is array OR null</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (prevShapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">TEXT_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">hostSetElementText</span><span style="color:var(--shiki-color-text);">(container</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;&#39;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// mount new if array</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (shapeFlag </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">ShapeFlags</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">ARRAY_CHILDREN</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">mountChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            c2 </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="patchkeyedchildren" tabindex="-1"><a class="header-anchor" href="#patchkeyedchildren" aria-hidden="true">#</a> patchKeyedChildren</h5><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// can be all-keyed or mixed</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">patchKeyedChildren</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c2</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    container</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererElement</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentAnchor</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererNode</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentComponent</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentSuspense</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">SuspenseBoundary</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    isSVG</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    slotScopeIds</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">string</span><span style="color:var(--shiki-color-text);">[] </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    optimized</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  ) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">l2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c2</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-token-comment);">// 获取旧 VNodes 长度</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> e1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c1</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 新 VNode 结束的索引</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> e2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> l2 </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 旧 VNode 结束的索引</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 多种操作数组的方法判断</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 1. 从头部开始遍历比较</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b) c</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b) d e</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">while</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e1 </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c1[i] </span><span style="color:var(--shiki-token-comment);">// 新 vnode</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (c2[i] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">cloneIfMounted</span><span style="color:var(--shiki-color-text);">(c2[i] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">normalizeVNode</span><span style="color:var(--shiki-color-text);">(c2[i])) </span><span style="color:var(--shiki-token-comment);">// 旧 vnode</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 是相同的 vnode，通过 key and 类型 判断</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isSameVNodeType</span><span style="color:var(--shiki-color-text);">(n1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> n2)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 比较</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          n1</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 不相同</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 找到对比不相同的 vnode 跳出循环，到下一步 2</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">break</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 头部取 ++ 操作</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      i</span><span style="color:var(--shiki-token-keyword);">++</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 2. 从尾部遍历比较 e1 e2(尾部长度)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// a (b c)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// d e (b c)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">while</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e1 </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 操作同上 1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c1[e1]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">n2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (c2[e2] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">cloneIfMounted</span><span style="color:var(--shiki-color-text);">(c2[e2] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">normalizeVNode</span><span style="color:var(--shiki-color-text);">(c2[e2]))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-function);">isSameVNodeType</span><span style="color:var(--shiki-color-text);">(n1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> n2)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          n1</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          n2</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-comment);">// 找到对比不相同的 vnode 跳出循环，到下一步 3</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">break</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 尾部取 -- 操作</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      e1</span><span style="color:var(--shiki-token-keyword);">--</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      e2</span><span style="color:var(--shiki-token-keyword);">--</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 3. 当比较发现 c2 新 vnode 新增的，挂载新 vnode</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b) c</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// i = 2, e1 = 1, e2 = 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// c (a b)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// i = 0, e1 = -1, e2 = 0</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> e1) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">nextPos</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> e2 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-comment);">// 获取新 vnode 位置</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">anchor</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> nextPos </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> l2 </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> (c2[nextPos] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">).el </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> parentAnchor</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">while</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// 利用空的 与 c2 新的比较，当这里为空表示为一个挂操作</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            (c2[i] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">cloneIfMounted</span><span style="color:var(--shiki-color-text);">(c2[i] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">normalizeVNode</span><span style="color:var(--shiki-color-text);">(c2[i]))</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          i</span><span style="color:var(--shiki-token-keyword);">++</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 4. 当比较发现 c1 旧 vnode，剩余多余的，卸载多余的 vnode</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b) c</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (a b)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// i = 2, e1 = 2, e2 = 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// a (b c)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// (b c)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// i = 0, e1 = 0, e2 = -1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> e2) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">while</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e1) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">unmount</span><span style="color:var(--shiki-color-text);">(c1[i]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        i</span><span style="color:var(--shiki-token-keyword);">++</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 5. 当比较完前后，发现中间产生比较多的交叉错乱的 vnode(无序的，乱七八糟的)，Vue 并不是全部删除重新挂载</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 如果对比发现是多余的(c1里面)，除去</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 如果对比发现是存在的，类型相同的，或者新的，那么【移动和挂载新的 vnode】</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// [i ... e1 + 1]: a b [c d e] f g</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// [i ... e2 + 1]: a b [e d c h] f g</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// i = 2, e1 = 4, e2 = 5</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">s1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-comment);">// prev starting index</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">s2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-comment);">// next starting index</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 5.1 build key:index map for newChildren</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">keyToNewIndexMap</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Map</span><span style="color:var(--shiki-color-text);">&lt;</span><span style="color:var(--shiki-token-constant);">string</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">number</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">symbol</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">number</span><span style="color:var(--shiki-color-text);">&gt; </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">new</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Map</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s2; i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (c2[i] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">cloneIfMounted</span><span style="color:var(--shiki-color-text);">(c2[i] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">normalizeVNode</span><span style="color:var(--shiki-color-text);">(c2[i]))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);">.key </span><span style="color:var(--shiki-token-keyword);">!=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (__DEV__ </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">keyToNewIndexMap</span><span style="color:var(--shiki-token-function);">.has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);">.key)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-function);">warn</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-string-expression);">`Duplicate keys found during update:`</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-constant);">JSON</span><span style="color:var(--shiki-token-function);">.stringify</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);">.key)</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-string-expression);">`Make sure keys are unique.`</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-constant);">keyToNewIndexMap</span><span style="color:var(--shiki-token-function);">.set</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);">.key</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> i)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 5.2 loop through old children left to be patched and try to patch</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// matching nodes &amp; remove nodes that are no longer present</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> j</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> patched </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">toBePatched</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> e2 </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> s2 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> moved </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// used to track whether any node has moved</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> maxNewIndexSoFar </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// works as Map&lt;newIndex, oldIndex&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// Note that oldIndex is offset by +1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// and oldIndex = 0 is a special value indicating the new node has</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// no corresponding old node.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// used for determining longest stable subsequence</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">newIndexToOldIndexMap</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">new</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Array</span><span style="color:var(--shiki-color-text);">(toBePatched)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">; i </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> toBePatched; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) newIndexToOldIndexMap[i] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s1; i </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e1; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">prevChild</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c1[i]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (patched </span><span style="color:var(--shiki-token-keyword);">&gt;=</span><span style="color:var(--shiki-color-text);"> toBePatched) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// all new children have been patched so this can only be a removal</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">unmount</span><span style="color:var(--shiki-color-text);">(prevChild</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">continue</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> newIndex</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">prevChild</span><span style="color:var(--shiki-color-text);">.key </span><span style="color:var(--shiki-token-keyword);">!=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          newIndex </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">keyToNewIndexMap</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">prevChild</span><span style="color:var(--shiki-color-text);">.key)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// key-less node, try to locate a key-less node of the same type</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (j </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s2; j </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-color-text);"> e2; j</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              newIndexToOldIndexMap[j </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> s2] </span><span style="color:var(--shiki-token-keyword);">===</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-function);">isSameVNodeType</span><span style="color:var(--shiki-color-text);">(prevChild</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> c2[j] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            ) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              newIndex </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> j</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">              </span><span style="color:var(--shiki-token-keyword);">break</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (newIndex </span><span style="color:var(--shiki-token-keyword);">===</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">undefined</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">unmount</span><span style="color:var(--shiki-color-text);">(prevChild</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          newIndexToOldIndexMap[newIndex </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> s2] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (newIndex </span><span style="color:var(--shiki-token-keyword);">&gt;=</span><span style="color:var(--shiki-color-text);"> maxNewIndexSoFar) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            maxNewIndexSoFar </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> newIndex</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            moved </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">true</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            prevChild</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            c2[newIndex] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          patched</span><span style="color:var(--shiki-token-keyword);">++</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 5.3 move and mount</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// generate longest stable subsequence only when nodes have moved</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">increasingNewIndexSequence</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> moved</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">getSequence</span><span style="color:var(--shiki-color-text);">(newIndexToOldIndexMap)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">EMPTY_ARR</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      j </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">increasingNewIndexSequence</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// looping backwards so that we can use last patched node as anchor</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> toBePatched </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">; i </span><span style="color:var(--shiki-token-keyword);">&gt;=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">; i</span><span style="color:var(--shiki-token-keyword);">--</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">nextIndex</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s2 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> i</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c2[nextIndex] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">anchor</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          nextIndex </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> l2 </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> (c2[nextIndex </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">).el </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> parentAnchor</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (newIndexToOldIndexMap[i] </span><span style="color:var(--shiki-token-keyword);">===</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// mount new</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            nextChild</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (moved) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// move if:</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// There is no stable subsequence (e.g. a reverse)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-comment);">// OR current node is not among the stable sequence</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (j </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> i </span><span style="color:var(--shiki-token-keyword);">!==</span><span style="color:var(--shiki-color-text);"> increasingNewIndexSequence[j]) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            </span><span style="color:var(--shiki-token-function);">move</span><span style="color:var(--shiki-color-text);">(nextChild</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> container</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> anchor</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">MoveType</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">REORDER</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">            j</span><span style="color:var(--shiki-token-keyword);">--</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">          }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="patchunkeyedchildren" tabindex="-1"><a class="header-anchor" href="#patchunkeyedchildren" aria-hidden="true">#</a> patchUnkeyedChildren</h5><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">patchUnkeyedChildren</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">[]</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c2</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNodeArrayChildren</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    container</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererElement</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    anchor</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">RendererNode</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentComponent</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ComponentInternalInstance</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    parentSuspense</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">SuspenseBoundary</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    isSVG</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    slotScopeIds</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">string</span><span style="color:var(--shiki-color-text);">[] </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    optimized</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">boolean</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  ) </span><span style="color:var(--shiki-token-keyword);">=&gt;</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c1 </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">EMPTY_ARR</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    c2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c2 </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">EMPTY_ARR</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">oldLength</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c1</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 新 vnodes 的长度</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">newLength</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">c2</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">length</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);">// 旧 vnodes 的长度</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 获取最小的那个 vnodes 的长度，用最小长度的 vnodes 遍历(用最大的可能产生越界，用长度最小的 vnodes 对比)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">commonLength</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Math</span><span style="color:var(--shiki-token-function);">.min</span><span style="color:var(--shiki-color-text);">(oldLength</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> newLength)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">let</span><span style="color:var(--shiki-color-text);"> i</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 依次 patch 比较</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">; i </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> commonLength; i</span><span style="color:var(--shiki-token-keyword);">++</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-keyword);">const</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">nextChild</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> (c2[i] </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">?</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">cloneIfMounted</span><span style="color:var(--shiki-color-text);">(c2[i] </span><span style="color:var(--shiki-token-keyword);">as</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">VNode</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">normalizeVNode</span><span style="color:var(--shiki-color-text);">(c2[i]))</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">patch</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        c1[i]</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        nextChild</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-constant);">null</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        optimized</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-comment);">// 旧的长度大于新的，进行切尾，删除多出来的长度的元素</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> (oldLength </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> newLength) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// remove old</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">unmountChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        c1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-constant);">true</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-constant);">false</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        commonLength</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    } </span><span style="color:var(--shiki-token-keyword);">else</span><span style="color:var(--shiki-color-text);"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// 旧的长度小于新的，创建新的多出来的节点</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-comment);">// mount new</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      </span><span style="color:var(--shiki-token-function);">mountChildren</span><span style="color:var(--shiki-color-text);">(</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        c2</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-comment);">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        container</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        anchor</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentComponent</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        parentSuspense</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        isSVG</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        slotScopeIds</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        optimized</span><span style="color:var(--shiki-token-punctuation);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        commonLength</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">      )</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/11/8 14:32:31</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: liyufeng@gz-yibo.com">李雨锋</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/docs/docs/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83.html" class="nav-link prev" aria-label="🛠️ 开发规范"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->🛠️ 开发规范</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/docs/assets/app.4ddfd4cd.js" defer></script>
  </body>
</html>
